<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì´ì¢‹ê³„ ê±°ë˜ë‚´ì—­ - ì™„ì „ê°œì„ ë²„ì „</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0;
            padding: 0;
        }

        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background: linear-gradient(-45deg, #0f0f23, #1a1a3a, #2d1b69, #3b1f8a, #4f46e5, #6366f1);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
            min-height: 100vh;
            color: white;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .app-container {
            max-width: 430px;
            margin: 0 auto;
            padding: 0.5rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .glass-card {
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0.05) 50%,
                rgba(255,255,255,0.1) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .tab-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.7);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border-radius: 8px;
            font-size: 0.75rem;
            padding: 0.5rem;
            cursor: pointer;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            color: white;
            box-shadow: 0 0 15px rgba(255,0,110,0.4);
        }

        .member-btn, .year-btn, .category-btn {
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #10b981);
            background-size: 300% 300%;
            animation: memberFlow 3s ease infinite;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            padding: 0.75rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            font-size: 0.85rem;
        }

        @keyframes memberFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .member-btn:hover, .year-btn:hover, .category-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,0.3);
        }

        .page-container {
            flex: 1;
            position: relative;
            min-height: 400px;
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 1rem;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .page.active {
            opacity: 1;
            transform: translateX(0);
        }

        .content-scroll {
            flex: 1;
            overflow-y: auto;
            padding-right: 0.5rem;
            max-height: 50vh;
        }

        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem;
            margin-top: 1rem;
        }

        .transaction-table th,
        .transaction-table td {
            padding: 0.5rem 0.25rem;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: white;
        }

        .transaction-table th {
            background: rgba(255,255,255,0.1);
            font-weight: 700;
            position: sticky;
            top: 0;
        }

        .amount.withdrawal { color: #ff6b6b; font-weight: 700; }
        .amount.deposit { color: #51cf66; font-weight: 700; }
        .amount.balance { color: #74c0fc; font-weight: 700; }

        .chart-container {
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .summary-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
        }

        .hidden { display: none !important; }

        .floating-buttons {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 0.5rem;
            margin: 0.5rem 0;
            backdrop-filter: blur(10px);
        }

        .upload-area {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: rgba(255,255,255,0.6);
            background: rgba(255,255,255,0.05);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            color: white;
        }

        .input-field {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: white;
            width: 100%;
            margin: 0.5rem 0;
        }

        .input-field::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,0,110,0.4);
        }

        .unpaid-item {
            background: rgba(255,107,107,0.2);
            border: 1px solid rgba(255,107,107,0.3);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            color: white;
            font-size: 0.9rem;
        }

        .calendar-container {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .notice-item, .meeting-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .receipt-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border-radius: 10px;
        }

        .update-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .update-btn-small {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border: none;
            border-radius: 4px;
            color: white;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s ease;
        }

        .update-btn-small:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255,0,110,0.4);
        }

        .edit-form {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 0;
        }

        .edit-form input {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            padding: 0.5rem;
            color: white;
            margin: 0.25rem;
            font-size: 0.8rem;
        }

        .edit-form input::placeholder {
            color: rgba(255,255,255,0.5);
        }
    </style>
</head>
<body>
    <!-- ê³µì§€ì‚¬í•­ íŒì—… -->
    <div id="noticeModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ“¢ ìµœì‹  ê³µì§€ì‚¬í•­</h3>
                <button onclick="closeNoticeModal()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="noticeContent" class="content-scroll" style="max-height: 60vh;">
                <!-- ê³µì§€ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
            </div>
            <div class="mt-4">
                <button class="btn-primary w-full" onclick="closeNoticeModal()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ëª¨ì„ ì¼ì • íŒì—… -->
    <div id="meetingModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ“… ë‹¤ìŒ ëª¨ì„ ì¼ì •</h3>
                <button onclick="closeMeetingModal()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="meetingContent">
                <!-- ëª¨ì„ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
            </div>
            <div class="mt-4">
                <button class="btn-primary w-full" onclick="closeMeetingModal()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ë°ì´í„° ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="updateModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ”„ ë°ì´í„° ê´€ë¦¬</h3>
                <button onclick="closeUpdateModal()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="passwordArea">
                <input type="password" id="updatePassword" class="input-field" placeholder="ê´€ë¦¬ì ì½”ë“œ ì…ë ¥">
                <button class="btn-primary w-full mt-2" onclick="checkPassword()">í™•ì¸</button>
            </div>
            <div id="dataArea" class="hidden">
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button class="tab-btn active" id="pasteDataTab" onclick="showUpdateTab('paste')">ì—…ë°ì´íŠ¸</button>
                    <button class="tab-btn" id="editDataTab" onclick="showUpdateTab('edit')">ìˆ˜ì •í•˜ê¸°</button>
                </div>
                <div id="pasteArea">
                    <textarea id="updateData" class="input-field h-24" placeholder="ì—‘ì…€ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”..."></textarea>
                    <button class="btn-primary w-full mb-2" onclick="processUpdateFromPaste()">ë¶™ì—¬ë„£ê¸°</button>
                    <div class="upload-area mt-2" onclick="document.getElementById('csvUpload').click()">
                        <i class="fas fa-file-csv text-2xl text-green-400"></i>
                        <p>CSV íŒŒì¼ë¡œ ì—…ë°ì´íŠ¸</p>
                        <input type="file" id="csvUpload" accept=".csv" style="display: none;" onchange="handleFileUpload(event)">
                    </div>
                </div>
                <div id="editArea" class="hidden">
                    <div class="content-scroll" style="max-height: 300px;">
                        <table class="transaction-table"><thead><tr><th>ë‚ ì§œ</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th><th>ìˆ˜ì •</th></tr></thead>
                            <tbody id="updateTransactionList"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìˆ˜ì • í¼ ëª¨ë‹¬ -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content">
             <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ“ í•­ëª© ìˆ˜ì •</h3>
                <button onclick="cancelEdit()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="editForm" class="edit-form">
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="text" id="editNo" placeholder="No." readonly>
                    <input type="text" id="editDate" placeholder="ë‚ ì§œ (YY.MM.DD)">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="text" id="editContent" placeholder="ê¸°ì¬ë‚´ìš©">
                    <input type="text" id="editMemo" placeholder="ë©”ëª¨">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="number" id="editWithdrawal" placeholder="ì°¾ì€ê¸ˆì•¡" min="0">
                    <input type="number" id="editDeposit" placeholder="ë§¡ê¸´ê¸ˆì•¡" min="0">
                </div>
                <div class="flex gap-2 mt-4">
                    <button class="btn-primary flex-1" onclick="saveEdit()">ì €ì¥</button>
                    <button class="btn-primary flex-1" onclick="cancelEdit()">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="glass-card p-3 text-center mb-3">
            <div class="update-title">
                <h1 class="text-lg font-black flex-1"><i class="fas fa-coins mr-2 text-yellow-400"></i>ì‚¬ì´ì¢‹ê³„ ê±°ë˜ë‚´ì—­</h1>
                <button class="update-btn-small" onclick="openUpdateModal()"><i class="fas fa-sync-alt"></i> ê´€ë¦¬</button>
            </div>
            <div class="text-sm text-gray-300 mt-1" id="currentDate"></div>
        </div>

        <!-- Tab Navigation -->
        <div class="glass-card p-2 mb-3">
            <div class="grid grid-cols-4 gap-1 mb-2">
                <button class="tab-btn active" data-page="0">ì „ì²´</button>
                <button class="tab-btn" data-page="1">ë…„ë³„</button>
                <button class="tab-btn" data-page="2">íšŒì›ë³„</button>
                <button class="tab-btn" data-page="3">ì§€ì¶œ</button>
            </div>
            <div class="grid grid-cols-4 gap-1">
                <button class="tab-btn" data-page="4">ë¯¸ë‚©ê¸ˆ</button>
                <button class="tab-btn" data-page="5">ì˜ìˆ˜ì¦</button>
                <button class="tab-btn" data-page="6">ê³µì§€</button>
                <button class="tab-btn" data-page="7">ëª¨ì„</button>
            </div>
        </div>

        <!-- Floating Buttons -->
        <div id="yearButtons" class="floating-buttons hidden"><div class="grid grid-cols-4 gap-2"><button class="year-btn" data-year="2023">2023</button><button class="year-btn" data-year="2024">2024</button><button class="year-btn" data-year="2025">2025</button><button class="year-btn active" data-year="all">ì „ì²´</button></div></div>
        <div id="memberButtons" class="floating-buttons hidden"><div class="grid grid-cols-4 gap-2 mb-2"><button class="member-btn" data-member="ê¹€ë´‰ì² ">ê¹€ë´‰ì² </button><button class="member-btn" data-member="ê¹€ë´‰ì •">ê¹€ë´‰ì •</button><button class="member-btn" data-member="ë°°ì •ê¸¸">ë°°ì •ê¸¸</button><button class="member-btn" data-member="ì´í•´ê²½">ì´í•´ê²½</button></div><div class="grid grid-cols-4 gap-2"><button class="member-btn" data-member="í™©ìƒí˜¸">í™©ìƒí˜¸</button><button class="member-btn" data-member="ê³½ìƒíƒœ">ê³½ìƒíƒœ</button><button class="member-btn" data-member="ì´í•œìš±">ì´í•œìš±</button><button class="member-btn" data-member="@ì´ì">ì´ì</button></div></div>
        <div id="expenseButtons" class="floating-buttons hidden"><div class="grid grid-cols-2 gap-2"><button class="category-btn active" data-expense-type="monthly">ì›”ë³„</button><button class="category-btn" data-expense-type="category">í•­ëª©ë³„</button></div></div>

        <!-- Page Container -->
        <div class="page-container glass-card" style="flex-grow: 1;">
            <!-- Page 0: ì „ì²´ -->
            <div class="page active" data-page="0">
                <h2 class="text-lg font-bold mb-3">ğŸ’° ì „ì²´ ê±°ë˜ë‚´ì—­</h2>
                <div class="summary-grid"><div class="summary-item"><div class="text-xs text-gray-300">ì´ ì…ê¸ˆ</div><div class="text-green-400 font-bold" id="totalDeposit">0ì›</div></div><div class="summary-item"><div class="text-xs text-gray-300">ì´ ì§€ì¶œ</div><div class="text-red-400 font-bold" id="totalWithdrawal">0ì›</div></div></div>
                <div class="summary-grid"><div class="summary-item"><div class="text-xs text-gray-300">í˜„ì¬ ì”ì•¡</div><div class="text-blue-400 font-bold" id="currentBalance">0ì›</div></div><div class="summary-item"><div class="text-xs text-gray-300">ê±°ë˜ ê±´ìˆ˜</div><div class="text-white font-bold" id="totalTransactions">0ê±´</div></div></div>
                <div class="content-scroll" id="allTransactionsContainer"><table class="transaction-table"><thead><tr><th>ë‚ ì§œ</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th><th>ì”ì•¡</th></tr></thead><tbody id="allTransactions"></tbody></table></div>
                <div class="flex justify-center mt-2"><button id="prevPageBtn" class="btn-primary">ì´ì „</button><span id="pageIndicator" class="mx-4 self-center"></span><button id="nextPageBtn" class="btn-primary">ë‹¤ìŒ</button></div>
            </div>

            <!-- Page 1: ë…„ë³„ -->
            <div class="page" data-page="1"><h2 class="text-lg font-bold mb-3">ğŸ“Š ë…„ë³„ í†µê³„</h2><div class="chart-container"><canvas id="yearlyChart"></canvas></div><div class="content-scroll"><div id="yearlyStats"></div></div></div>

            <!-- Page 2: íšŒì›ë³„ -->
            <div class="page" data-page="2"><h2 class="text-lg font-bold mb-3">ğŸ‘¥ íšŒì›ë³„ í˜„í™©</h2><div id="memberStats" class="summary-grid hidden"><div class="summary-item"><div class="text-xs text-gray-300">ì´ ì…ê¸ˆì•¡</div><div class="text-green-400 font-bold" id="memberTotalAmount">0ì›</div></div><div class="summary-item"><div class="text-xs text-gray-300">ì…ê¸ˆ íšŸìˆ˜</div><div class="text-blue-400 font-bold" id="memberTotalCount">0íšŒ</div></div></div><div class="content-scroll"><table class="transaction-table"><thead><tr><th>ë‚ ì§œ</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th><th>ë©”ëª¨</th></tr></thead><tbody id="memberTransactions"></tbody></table></div></div>

            <!-- Page 3: ì§€ì¶œ -->
            <div class="page" data-page="3"><h2 class="text-lg font-bold mb-3">ğŸ’¸ ì§€ì¶œ ë¶„ì„</h2><div class="grid grid-cols-2 gap-4"><div class="chart-container" style="height: 150px;"><canvas id="expenseBarChart"></canvas></div><div class="chart-container" style="height: 150px;"><canvas id="expenseDoughnutChart"></canvas></div></div><div class="content-scroll" id="expenseDetails"></div></div>

            <!-- Page 4: ë¯¸ë‚©ê¸ˆ -->
            <div class="page" data-page="4"><h2 class="text-lg font-bold mb-3">âš ï¸ ë¯¸ë‚©ê¸ˆ í˜„í™©</h2><p class="text-xs text-gray-400 mb-3">(2025ë…„ 8ì›” ê¸°ì¤€, ìë™ì´ì²´ ì‹œ ê¸ˆì›”ë¶„ ì œì™¸)</p><div class="content-scroll" id="unpaidList"></div></div>

            <!-- Page 5: ì˜ìˆ˜ì¦ -->
            <div class="page" data-page="5"><h2 class="text-lg font-bold mb-3">ğŸ“· ì˜ìˆ˜ì¦ ê´€ë¦¬</h2><div class="content-scroll"><button class="btn-primary w-full mb-4" onclick="document.getElementById('receiptUpload').click()">ì˜ìˆ˜ì¦ ë“±ë¡</button><input type="file" id="receiptUpload" accept="image/*" style="display: none;" onchange="handleReceiptUpload(event)"><div id="receiptList"></div></div></div>

            <!-- Page 6: ê³µì§€ -->
            <div class="page" data-page="6"><h2 class="text-lg font-bold mb-3">ğŸ“¢ ê³µì§€ì‚¬í•­</h2><div class="content-scroll"><div class="mb-4"><input type="text" id="noticeUser" class="input-field" placeholder="ë“±ë¡ì ì´ë¦„"><textarea id="newNotice" class="input-field h-24" placeholder="ìƒˆ ê³µì§€ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><button class="btn-primary mt-2 w-full" onclick="addNotice()"><i class="fas fa-megaphone mr-2"></i>ê³µì§€ ë“±ë¡</button></div><div id="noticeList"></div></div></div>

            <!-- Page 7: ëª¨ì„ -->
            <div class="page" data-page="7"><h2 class="text-lg font-bold mb-3">ğŸ“… ëª¨ì„ ì¼ì •</h2><div class="content-scroll"><div class="calendar-container"><input type="text" id="meetingUser" class="input-field mb-2" placeholder="ë“±ë¡ì ì´ë¦„"><input type="datetime-local" id="meetingDate" class="input-field mb-2"><input type="text" id="meetingPlace" class="input-field mb-2" placeholder="ëª¨ì„ ì¥ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”..."><textarea id="meetingDescription" class="input-field h-16" placeholder="ëª¨ì„ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><button class="btn-primary w-full mt-2" onclick="addMeeting()"><i class="fas fa-calendar-plus mr-2"></i>ëª¨ì„ ë“±ë¡</button></div><div id="meetingList"></div></div></div>
        </div>
    </div>

    <script src="./data.js"></script>
    <script>
        // =================================================================================
        // ì „ì—­ ë³€ìˆ˜, ìƒìˆ˜ ë° ìƒíƒœ ê´€ë¦¬
        // =================================================================================
        let allTransactionData = [];
        let notices = [];
        let meetings = [];
        let receipts = [];
        
        let currentPage = 0;
        const ITEMS_PER_PAGE = 20; // ì „ì²´ ë·°ì˜ í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜

        let yearlyChart, expenseBarChart, expenseDoughnutChart;
        let editingIndex = -1;
        let isPasswordVerified = false;

        const MEMBERS = {
            'ê¹€ë´‰ì² ': { aliases: ['ë°•í¬ì •'] }, 'ê¹€ë´‰ì •': { aliases: ['ê°•ê·€ì„ '] },
            'ë°°ì •ê¸¸': { aliases: ['ì´ê¸ˆì'] }, 'ì´í•´ê²½': { aliases: [] },
            'í™©ìƒí˜¸': { aliases: [] }, 'ê³½ìƒíƒœ': { aliases: [] },
            'ì´í•œìš±': { aliases: ['ì •ë¯¸ìˆ™'] }
        };
        const ALL_MEMBER_NAMES = Object.keys(MEMBERS);

        // =================================================================================
        // ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë”©
        // =================================================================================
        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            loadData();
            normalizeData();
            updateCurrentDate();
            setupEventListeners();
            showPage(0); // ì´ˆê¸° í˜ì´ì§€ ì„¤ì •
            showInitialNotice();
        }

        function loadData() {
            if (typeof window.jotData !== 'undefined') {
                allTransactionData = JSON.parse(JSON.stringify(window.jotData.transactions || []));
                notices = JSON.parse(JSON.stringify(window.jotData.notices || []));
                console.log('ë°ì´í„° ë¡œë“œ ì„±ê³µ (data.js)');
            } else {
                console.warn("data.js ë¡œë”© ì‹¤íŒ¨. localStorage ë˜ëŠ” ìƒ˜í”Œ ë°ì´í„°ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
                allTransactionData = getSampleData();
                notices = loadFromLocalStorage('notices');
            }
            meetings = loadFromLocalStorage('meetings');
            receipts = loadFromLocalStorage('receipts');
        }

        function normalizeData() {
            const nameMap = {};
            for (const [name, { aliases }] of Object.entries(MEMBERS)) {
                aliases.forEach(alias => { nameMap[alias] = name; });
            }
            allTransactionData.forEach(item => {
                const alias = Object.keys(nameMap).find(a => item.ê¸°ì¬ë‚´ìš©.includes(a) || (item.ë©”ëª¨ && item.ë©”ëª¨.includes(a)));
                if (alias) item.ê¸°ì¬ë‚´ìš© = nameMap[alias];
            });
            allTransactionData.sort((a, b) => b['No.'] - a['No.']);
            notices.sort((a, b) => b.id - a.id);
        }

        // =================================================================================
        // ë Œë”ë§ ë° UI ì—…ë°ì´íŠ¸
        // =================================================================================
        function renderCurrentPage() {
            const pageNum = parseInt(document.querySelector('.tab-btn.active').dataset.page);
            showPage(pageNum, false);
        }

        function updateCurrentDate() {
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        }

        function renderAllTransactions() {
            const tbody = document.getElementById('allTransactions');
            tbody.innerHTML = '';
            const paginatedData = allTransactionData.slice(currentPage * ITEMS_PER_PAGE, (currentPage + 1) * ITEMS_PER_PAGE);
            paginatedData.forEach(item => {
                const isDeposit = item.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0;
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.ê±°ë˜ì¼ì‹œ)}</td>
                        <td>${item.ê¸°ì¬ë‚´ìš©}</td>
                        <td class="amount ${isDeposit ? 'deposit' : 'withdrawal'}">${isDeposit ? '+' : '-'}${formatNumber(isDeposit ? item.ë§¡ê¸°ì‹ ê¸ˆì•¡ : item.ì°¾ìœ¼ì‹ ê¸ˆì•¡)}ì›</td>
                        <td class="amount balance">${formatNumber(item['ê±°ë˜í›„ ì”ì•¡'])}ì›</td>
                    </tr>`;
            });
            document.getElementById('pageIndicator').textContent = `${currentPage + 1} / ${Math.ceil(allTransactionData.length / ITEMS_PER_PAGE)}`;
            document.getElementById('prevPageBtn').disabled = currentPage === 0;
            document.getElementById('nextPageBtn').disabled = currentPage >= Math.ceil(allTransactionData.length / ITEMS_PER_PAGE) - 1;
        }

        function renderSummary() {
            const totalDeposit = allTransactionData.reduce((sum, item) => sum + (item.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0), 0);
            const totalWithdrawal = allTransactionData.reduce((sum, item) => sum + (item.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0), 0);
            const currentBalance = allTransactionData.length > 0 ? (allTransactionData[0]['ê±°ë˜í›„ ì”ì•¡'] || 0) : 0;
            document.getElementById('totalDeposit').textContent = formatNumber(totalDeposit) + 'ì›';
            document.getElementById('totalWithdrawal').textContent = formatNumber(totalWithdrawal) + 'ì›';
            document.getElementById('currentBalance').textContent = formatNumber(currentBalance) + 'ì›';
            document.getElementById('totalTransactions').textContent = allTransactionData.length + 'ê±´';
        }

        // =================================================================================
        // ê¸°ëŠ¥ë³„ êµ¬í˜„
        // =================================================================================
        function calculateUnpaidAmounts() {
            const standardAmount = 960000, specialAmount = 600000;
            const memberTotals = {};
            ALL_MEMBER_NAMES.forEach(name => memberTotals[name] = 0);
            allTransactionData.forEach(item => {
                if (item.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0 && ALL_MEMBER_NAMES.includes(item.ê¸°ì¬ë‚´ìš©)) {
                    memberTotals[item.ê¸°ì¬ë‚´ìš©] += item.ë§¡ê¸°ì‹ ê¸ˆì•¡;
                }
            });
            const unpaidList = document.getElementById('unpaidList');
            unpaidList.innerHTML = '';
            ALL_MEMBER_NAMES.forEach(member => {
                const unpaid = (member === 'ê³½ìƒíƒœ' ? specialAmount : standardAmount) - memberTotals[member];
                if (unpaid > 0) {
                    unpaidList.innerHTML += `<div class="unpaid-item flex justify-between"><span>ğŸ‘¤ ${member}</span> <span class="text-red-400">${formatNumber(unpaid)}ì›</span></div>`;
                }
            });
            if (!unpaidList.innerHTML) unpaidList.innerHTML = `<div class="summary-item text-center"><i class="fas fa-check-circle text-green-400 text-2xl"></i><p>ëª¨ë“  íšŒì› ì •ìƒ ë‚©ë¶€!</p></div>`;
        }

        function createYearlyChart(year) {
            const ctx = document.getElementById('yearlyChart').getContext('2d');
            if (yearlyChart) yearlyChart.destroy();
            const filtered = year === 'all' ? allTransactionData : allTransactionData.filter(i => parseYear(i.ê±°ë˜ì¼ì‹œ) === parseInt(year));
            const monthlyData = Array(12).fill(0).map(() => ({ deposit: 0, withdrawal: 0 }));
            filtered.forEach(i => {
                const month = parseInt(i.ê±°ë˜ì¼ì‹œ.split('.')[1]) - 1;
                if (month >= 0 && month < 12) {
                    monthlyData[month].deposit += i.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0;
                    monthlyData[month].withdrawal += i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0;
                }
            });
            yearlyChart = new Chart(ctx, { type: 'bar', data: { labels: Array.from({ length: 12 }, (_, i) => `${i + 1}ì›”`), datasets: [{ label: 'ì…ê¸ˆ', data: monthlyData.map(d => d.deposit), backgroundColor: 'rgba(81, 207, 102, 0.8)' }, { label: 'ì§€ì¶œ', data: monthlyData.map(d => d.withdrawal), backgroundColor: 'rgba(255, 107, 107, 0.8)' }] }, options: getChartOptions() });
            updateYearlyStats(year, filtered);
        }

        function updateYearlyStats(year, filtered) {
            const totalDeposit = filtered.reduce((s, i) => s + (i.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0), 0);
            const totalWithdrawal = filtered.reduce((s, i) => s + (i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0), 0);
            document.getElementById('yearlyStats').innerHTML = `<div class="summary-grid"><div class="summary-item"><div class="text-xs">${year === 'all' ? 'ì „ì²´' : year} ì…ê¸ˆ</div><div class="text-green-400 font-bold">${formatNumber(totalDeposit)}ì›</div></div><div class="summary-item"><div class="text-xs">${year === 'all' ? 'ì „ì²´' : year} ì§€ì¶œ</div><div class="text-red-400 font-bold">${formatNumber(totalWithdrawal)}ì›</div></div></div>`;
        }

        function showMemberData(member) {
            document.getElementById('memberStats').classList.remove('hidden');
            const tbody = document.getElementById('memberTransactions');
            const filtered = allTransactionData.filter(item => item.ê¸°ì¬ë‚´ìš© === member || (member === '@ì´ì' && item.ê¸°ì¬ë‚´ìš©.includes('ì´ì')));
            const totalAmount = filtered.reduce((s, i) => s + (i.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0), 0);
            document.getElementById('memberTotalAmount').textContent = formatNumber(totalAmount) + 'ì›';
            document.getElementById('memberTotalCount').textContent = filtered.filter(i => i.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0).length + 'íšŒ';
            tbody.innerHTML = '';
            filtered.forEach(item => {
                tbody.innerHTML += `<tr><td>${formatDate(item.ê±°ë˜ì¼ì‹œ)}</td><td>${item.ê¸°ì¬ë‚´ìš©}</td><td class="amount deposit">+${formatNumber(item.ë§¡ê¸°ì‹ ê¸ˆì•¡)}ì›</td><td>${item.ë©”ëª¨ || ''}</td></tr>`;
            });
        }

        function renderExpenseCharts() {
            const expenseData = allTransactionData.filter(i => i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ > 0);
            const monthlyExpenses = Array(12).fill(0);
            const categoryExpenses = {};

            expenseData.forEach(item => {
                const month = parseInt(item.ê±°ë˜ì¼ì‹œ.split('.')[1]) - 1;
                if (month >= 0 && month < 12) monthlyExpenses[month] += item.ì°¾ìœ¼ì‹ ê¸ˆì•¡;
                let category = 'ê¸°íƒ€';
                if (item.ê¸°ì¬ë‚´ìš©.includes('ì •ê·œëª¨ì„')) category = 'ì •ê·œëª¨ì„';
                else if (item.ê¸°ì¬ë‚´ìš©.includes('ê²½ì¡°ì‚¬')) category = 'ê²½ì¡°ì‚¬';
                categoryExpenses[category] = (categoryExpenses[category] || 0) + item.ì°¾ìœ¼ì‹ ê¸ˆì•¡;
            });

            if (expenseBarChart) expenseBarChart.destroy();
            expenseBarChart = new Chart(document.getElementById('expenseBarChart').getContext('2d'), { type: 'bar', data: { labels: Array.from({ length: 12 }, (_, i) => `${i + 1}ì›”`), datasets: [{ label: 'ì›”ë³„ ì§€ì¶œ', data: monthlyExpenses, backgroundColor: '#ff9f43' }] }, options: getChartOptions() });

            if (expenseDoughnutChart) expenseDoughnutChart.destroy();
            expenseDoughnutChart = new Chart(document.getElementById('expenseDoughnutChart').getContext('2d'), { type: 'doughnut', data: { labels: Object.keys(categoryExpenses), datasets: [{ data: Object.values(categoryExpenses), backgroundColor: ['#ff6b6b', '#feca57', '#48dbfb', '#1dd1a1'] }] }, options: getChartOptions(false) });
        }

        function renderExpenseDetails(type) {
            const detailsContainer = document.getElementById('expenseDetails');
            detailsContainer.innerHTML = '';
            const expenseData = allTransactionData.filter(i => i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ > 0);
            let grouped = {};
            if (type === 'monthly') {
                expenseData.forEach(item => {
                    const month = `${parseYear(item.ê±°ë˜ì¼ì‹œ)}ë…„ ${item.ê±°ë˜ì¼ì‹œ.split('.')[1]}ì›”`;
                    if (!grouped[month]) grouped[month] = [];
                    grouped[month].push(item);
                });
            } else { // category
                expenseData.forEach(item => {
                    let category = 'ê¸°íƒ€';
                    if (item.ê¸°ì¬ë‚´ìš©.includes('ì •ê·œëª¨ì„')) category = 'ì •ê·œëª¨ì„';
                    else if (item.ê¸°ì¬ë‚´ìš©.includes('ê²½ì¡°ì‚¬')) category = 'ê²½ì¡°ì‚¬';
                    if (!grouped[category]) grouped[category] = [];
                    grouped[category].push(item);
                });
            }

            for (const [group, items] of Object.entries(grouped)) {
                let tableRows = items.map(i => `<tr><td>${formatDate(i.ê±°ë˜ì¼ì‹œ)}</td><td>${i.ê¸°ì¬ë‚´ìš©}</td><td>${formatNumber(i.ì°¾ìœ¼ì‹ ê¸ˆì•¡)}ì›</td><td>${i.ë©”ëª¨ || ''}</td></tr>`).join('');
                detailsContainer.innerHTML += `<h3 class="text-md font-bold mt-4 mb-2">${group}</h3><table class="transaction-table">${tableRows}</table>`;
            }
        }

        // ë°ì´í„° ê´€ë¦¬ (ì—…ë°ì´íŠ¸/ìˆ˜ì •)
        function openUpdateModal() { document.getElementById('updateModal').classList.remove('hidden'); }
        function closeUpdateModal() {
            document.getElementById('updateModal').classList.add('hidden');
            document.getElementById('passwordArea').classList.remove('hidden');
            document.getElementById('dataArea').classList.add('hidden');
            document.getElementById('updatePassword').value = '';
            isPasswordVerified = false;
        }
        function checkPassword() {
            if (document.getElementById('updatePassword').value === '5691') {
                isPasswordVerified = true;
                document.getElementById('passwordArea').classList.add('hidden');
                document.getElementById('dataArea').classList.remove('hidden');
                showUpdateTab('paste');
            } else {
                alert('ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }
        function showUpdateTab(tab) {
            document.getElementById('pasteArea').classList.toggle('hidden', tab !== 'paste');
            document.getElementById('editArea').classList.toggle('hidden', tab !== 'edit');
            document.getElementById('pasteDataTab').classList.toggle('active', tab === 'paste');
            document.getElementById('editDataTab').classList.toggle('active', tab === 'edit');
            if (tab === 'edit') renderUpdateTransactionList();
        }
        function renderUpdateTransactionList() {
            const tbody = document.getElementById('updateTransactionList');
            tbody.innerHTML = '';
            allTransactionData.forEach((item, index) => {
                const isDeposit = item.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0;
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.ê±°ë˜ì¼ì‹œ)}</td>
                        <td>${item.ê¸°ì¬ë‚´ìš©}</td>
                        <td class="amount ${isDeposit ? 'deposit' : 'withdrawal'}">${isDeposit ? '+' : '-'}${formatNumber(isDeposit ? item.ë§¡ê¸°ì‹ ê¸ˆì•¡ : item.ì°¾ìœ¼ì‹ ê¸ˆì•¡)}</td>
                        <td><button class="update-btn-small" onclick="editTransaction(${index})">ìˆ˜ì •</button></td>
                    </tr>`;
            });
        }
        
        function processUpdateFromPaste() {
            const data = document.getElementById('updateData').value.trim();
            if (!data) return;
            try {
                const newItems = parseCSV(data);
                if (newItems.length > 0) {
                    updateTransactionData(newItems);
                }
            } catch (error) { alert('ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message); }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const newItems = parseCSV(e.target.result);
                    if (newItems.length > 0) {
                        updateTransactionData(newItems);
                    } else {
                        alert('íŒŒì¼ì—ì„œ ìƒˆë¡œìš´ ê±°ë˜ë‚´ì—­ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert(`íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                }
            };
            reader.readAsText(file, 'EUC-KR'); // ì—‘ì…€ CSV ê¸°ë³¸ ì¸ì½”ë”©
        }

        function parseCSV(csvData) {
            const lines = csvData.split('\n').filter(line => line.trim());
            return lines.map(line => {
                const parts = line.split(',').map(p => p.trim());
                let content = parts[2];
                const alias = Object.keys(MEMBERS).find(name => MEMBERS[name].aliases.includes(content));
                if (alias) content = alias;
                return { "No.": parseInt(parts[0]), "ê±°ë˜ì¼ì‹œ": parts[1], "ê¸°ì¬ë‚´ìš©": content, "ì°¾ìœ¼ì‹ ê¸ˆì•¡": parseFloat(parts[3]) || 0, "ë§¡ê¸°ì‹ ê¸ˆì•¡": parseFloat(parts[4]) || 0, "ê±°ë˜í›„ ì”ì•¡": parseFloat(parts[5]) || 0, "ë©”ëª¨": parts[6] || "" };
            });
        }

        function updateTransactionData(newItems) {
            const existingEntries = new Set(allTransactionData.map(item => `${item.ê±°ë˜ì¼ì‹œ}_${item.ê¸°ì¬ë‚´ìš©}`));
            const uniqueNewItems = newItems.filter(item => !existingEntries.has(`${item.ê±°ë˜ì¼ì‹œ}_${item.ê¸°ì¬ë‚´ìš©}`));

            if (uniqueNewItems.length > 0) {
                allTransactionData = [...uniqueNewItems, ...allTransactionData];
                normalizeData();
                showDataUpdateModal(generateNewDataFileContent());
                alert(`${uniqueNewItems.length}ê°œì˜ ìƒˆë¡œìš´ ê±°ë˜ë‚´ì—­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. data.js íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.`);
                renderCurrentPage();
                closeUpdateModal();
            } else {
                alert("ìƒˆë¡œìš´ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        function editTransaction(index) {
            editingIndex = index;
            const item = allTransactionData[index];
            document.getElementById('editNo').value = item['No.'];
            document.getElementById('editDate').value = item.ê±°ë˜ì¼ì‹œ;
            document.getElementById('editContent').value = item.ê¸°ì¬ë‚´ìš©;
            document.getElementById('editMemo').value = item.ë©”ëª¨;
            document.getElementById('editWithdrawal').value = item.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0;
            document.getElementById('editDeposit').value = item.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0;
            document.getElementById('editModal').classList.remove('hidden');
        }
        function saveEdit() {
            if (editingIndex === -1) return;
            const item = allTransactionData[editingIndex];
            item.ê±°ë˜ì¼ì‹œ = document.getElementById('editDate').value;
            item.ê¸°ì¬ë‚´ìš© = document.getElementById('editContent').value;
            item.ë©”ëª¨ = document.getElementById('editMemo').value;
            item.ì°¾ìœ¼ì‹ ê¸ˆì•¡ = parseFloat(document.getElementById('editWithdrawal').value) || 0;
            item.ë§¡ê¸°ì‹ ê¸ˆì•¡ = parseFloat(document.getElementById('editDeposit').value) || 0;
            normalizeData();
            renderCurrentPage();
            renderUpdateTransactionList();
            cancelEdit();
            showDataUpdateModal(generateNewDataFileContent());
            alert('ìˆ˜ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. data.js íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.');
        }
        function cancelEdit() {
            editingIndex = -1;
            document.getElementById('editModal').classList.add('hidden');
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë° ë°ì´í„° íŒŒì¼ ì—…ë°ì´íŠ¸ ì•ˆë‚´
        function loadFromLocalStorage(key) { return JSON.parse(localStorage.getItem(key) || '[]'); }
        function saveToLocalStorage(key, data) { localStorage.setItem(key, JSON.stringify(data)); }

        function showDataUpdateModal(newContent) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.zIndex = '1001'; // ë‹¤ë¥¸ ëª¨ë‹¬ ìœ„ì— í‘œì‹œ
            modal.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-lg font-bold mb-4">ë°ì´í„° ì—…ë°ì´íŠ¸ í•„ìš”</h3>
                    <p class="mb-4">ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ <strong>data.js</strong> íŒŒì¼ ì „ì²´ì— ë®ì–´ì“°ì„¸ìš”.</p>
                    <textarea class="input-field" style="height: 200px; font-size: 0.7rem;" readonly>${newContent}</textarea>
                    <div class="flex gap-2 mt-4">
                        <button class="btn-primary flex-1" onclick="navigator.clipboard.writeText(this.previousElementSibling.value); alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');">ë³µì‚¬</button>
                        <button class="btn-primary flex-1" onclick="this.closest('.modal').remove()">ë‹«ê¸°</button>
                    </div>
                </div>`;
            document.body.appendChild(modal);
        }

        function generateNewDataFileContent() {
            const dataToSave = {
                transactions: allTransactionData,
                notices: notices
            };
            return `window.jotData = ${JSON.stringify(dataToSave, null, 4)};`;
        }

        function loadReceipts() {
            receipts = loadFromLocalStorage('receipts');
            const list = document.getElementById('receiptList');
            list.innerHTML = '';
            receipts.forEach(r => {
                list.innerHTML += `<div class="receipt-item" onclick="viewReceipt('${r.dataUrl}')"><div class="font-bold">${r.name}</div><div class="text-sm text-gray-400">ë“±ë¡ì: ${r.user} | ${r.date}</div></div>`;
            });
        }
        function handleReceiptUpload(event) {
            const file = event.target.files[0];
            const user = prompt("ë“±ë¡ì ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:", "");
            if (!file || !user) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                receipts.unshift({ id: Date.now(), name: file.name, user, date: new Date().toLocaleString('ko-KR'), dataUrl: e.target.result });
                saveToLocalStorage('receipts', receipts);
                loadReceipts();
                addNotice(user, `${user}ë‹˜ì´ ì˜ìˆ˜ì¦(${file.name})ì„ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.`);
            };
            reader.readAsDataURL(file);
        }
        function viewReceipt(dataUrl) { window.open(dataUrl, '_blank'); }

        function loadNotices() {
            const list = document.getElementById('noticeList');
            list.innerHTML = '';
            notices.forEach(n => {
                list.innerHTML += `<div class="notice-item"><div class="flex justify-between items-start mb-2"><div class="text-sm text-gray-400"><b>${n.user}</b> | ${n.date}</div><button onclick="deleteNotice(${n.id})" class="text-red-400"><i class="fas fa-times"></i></button></div><div>${n.content.replace(/\n/g, '<br>')}</div></div>`;
            });
        }
        function addNotice(user, content) {
            const userVal = user || document.getElementById('noticeUser').value.trim();
            const contentVal = content || document.getElementById('newNotice').value.trim();
            if (userVal && contentVal) {
                notices.unshift({ id: Date.now(), user: userVal, content: contentVal, date: new Date().toLocaleString('ko-KR') });
                document.getElementById('noticeUser').value = '';
                document.getElementById('newNotice').value = '';
                loadNotices();
                showDataUpdateModal(generateNewDataFileContent());
            }
        }
        function deleteNotice(id) {
            if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                notices = notices.filter(n => n.id !== id);
                loadNotices();
                showDataUpdateModal(generateNewDataFileContent());
            }
        }
        function showInitialNotice() {
            const lastShown = sessionStorage.getItem('lastNoticeShown');
            if (!lastShown) {
                const noticeContent = document.getElementById('noticeContent');
                noticeContent.innerHTML = '';
                notices.slice(0, 5).forEach(n => {
                    noticeContent.innerHTML += `<div class="notice-item"><b>${n.user}</b>: ${n.content} <span class="text-xs text-gray-400">(${n.date})</span></div>`;
                });
                document.getElementById('noticeModal').classList.remove('hidden');
                sessionStorage.setItem('lastNoticeShown', 'true');
            }
        }

        function loadMeetings() {
            meetings = loadFromLocalStorage('meetings');
            const list = document.getElementById('meetingList');
            list.innerHTML = '';
            meetings.forEach(m => {
                list.innerHTML += `<div class="meeting-item"><div class="flex justify-between items-start mb-2"><div class="text-sm text-gray-400"><b>${m.user}</b> | ${m.created}</div><button onclick="deleteMeeting(${m.id})" class="text-red-400"><i class="fas fa-times"></i></button></div><div class="font-bold mb-2">ğŸ“… ${m.date}</div><div class="mb-2">ğŸ“ ${m.place}</div><div>ğŸ“ ${m.description.replace(/\n/g, '<br>')}</div></div>`;
            });
        }
        function addMeeting() {
            const user = document.getElementById('meetingUser').value.trim();
            const date = document.getElementById('meetingDate').value;
            const place = document.getElementById('meetingPlace').value.trim();
            const description = document.getElementById('meetingDescription').value.trim();
            if (!user || !date || !place) {
                alert('ë“±ë¡ì, ëª¨ì„ ë‚ ì§œ, ì¥ì†Œë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            const newMeeting = { id: Date.now(), user, date: new Date(date).toLocaleString('ko-KR'), place, description: description || 'ì •ê·œëª¨ì„', created: new Date().toLocaleString('ko-KR') };
            meetings.unshift(newMeeting);
            saveToLocalStorage('meetings', meetings);
            ['meetingUser', 'meetingDate', 'meetingPlace', 'meetingDescription'].forEach(id => document.getElementById(id).value = '');
            loadMeetings();
            addNotice(user, `${user}ë‹˜ì´ ëª¨ì„(${newMeeting.date} at ${newMeeting.place})ì„ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.`);
            showMeetingPopup(newMeeting);
        }
        function deleteMeeting(id) {
            if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                meetings = meetings.filter(m => m.id !== id);
                saveToLocalStorage('meetings', meetings);
                loadMeetings();
            }
        }
        function showMeetingPopup(meeting) {
            const content = document.getElementById('meetingContent');
            content.innerHTML = `<div class="meeting-item"><p><strong>ğŸ—“ï¸ ì¼ì‹œ:</strong> ${meeting.date}</p><p><strong>ğŸ“ ì¥ì†Œ:</strong> ${meeting.place}</p><p><strong>ğŸ“ ë‚´ìš©:</strong> ${meeting.description}</p></div>`;
            document.getElementById('meetingModal').classList.remove('hidden');
        }

        // =================================================================================
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë° í—¬í¼
        // =================================================================================
        function setupEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.addEventListener('click', handleTabClick));
            document.querySelectorAll('.year-btn').forEach(btn => btn.addEventListener('click', e => {
                document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                createYearlyChart(e.currentTarget.dataset.year);
            }));
            document.querySelectorAll('.member-btn').forEach(btn => btn.addEventListener('click', e => {
                document.querySelectorAll('.member-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                showMemberData(e.currentTarget.dataset.member);
            }));
            document.querySelectorAll('.category-btn').forEach(btn => btn.addEventListener('click', e => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                renderExpenseDetails(e.currentTarget.dataset.expenseType);
            }));
            document.getElementById('prevPageBtn').addEventListener('click', () => { if (currentPage > 0) { currentPage--; renderAllTransactions(); } });
            document.getElementById('nextPageBtn').addEventListener('click', () => { if (currentPage < Math.ceil(allTransactionData.length / ITEMS_PER_PAGE) - 1) { currentPage++; renderAllTransactions(); } });
            document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeAllModals(); } });
        }

        function handleTabClick(e) {
            const pageNum = parseInt(e.currentTarget.dataset.page);
            showPage(pageNum);
        }

        function showPage(pageNum, switchTabs = true) {
            if (switchTabs) {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`.tab-btn[data-page="${pageNum}"]`).classList.add('active');
                hideAllFloatingButtons();
            }
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelector(`.page[data-page="${pageNum}"]`).classList.add('active');

            switch (pageNum) {
                case 0: renderAllTransactions(); renderSummary(); break;
                case 1: document.getElementById('yearButtons').classList.remove('hidden'); createYearlyChart('all'); break;
                case 2: document.getElementById('memberButtons').classList.remove('hidden'); showMemberData('ê¹€ë´‰ì² '); break;
                case 3: document.getElementById('expenseButtons').classList.remove('hidden'); renderExpenseCharts(); renderExpenseDetails('monthly'); break;
                case 4: calculateUnpaidAmounts(); break;
                case 5: loadReceipts(); break;
                case 6: loadNotices(); break;
                case 7: loadMeetings(); break;
            }
        }

        function hideAllFloatingButtons() {
            ['yearButtons', 'memberButtons', 'expenseButtons'].forEach(id => document.getElementById(id).classList.add('hidden'));
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
            cancelEdit();
            closeUpdateModal();
        }
        function closeNoticeModal() { document.getElementById('noticeModal').classList.add('hidden'); }
        function closeMeetingModal() { document.getElementById('meetingModal').classList.add('hidden'); }

        function formatDate(dateStr) {
            try {
                const [y, m, d] = dateStr.split('.');
                return `${parseYear(dateStr)}ë…„ ${m}ì›” ${d}ì¼`;
            } catch { return dateStr; }
        }
        function parseYear(dateStr) {
            const yearPart = parseInt(dateStr.split('.')[0]);
            return yearPart >= 70 ? 1900 + yearPart : 2000 + yearPart;
        }
        function formatNumber(num) { return new Intl.NumberFormat('ko-KR').format(num); }
        function getChartOptions(showYAxis = true) {
            return {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { labels: { color: 'white' } } },
                scales: {
                    y: { display: showYAxis, beginAtZero: true, ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            };
        }
    </script>
</body>
</html>