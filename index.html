<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì´ì¢‹ê³„ ê±°ë˜ë‚´ì—­ - ì™„ì „ê°œì„ ë²„ì „</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { 
            box-sizing: border-box; 
            margin: 0;
            padding: 0;
        }

        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background: linear-gradient(-45deg, #0f0f23, #1a1a3a, #2d1b69, #3b1f8a, #4f46e5, #6366f1);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
            min-height: 100vh;
            color: white;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .app-container {
            max-width: 430px;
            margin: 0 auto;
            padding: 0.5rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .glass-card {
            background: linear-gradient(135deg, 
                rgba(255,255,255,0.1) 0%,
                rgba(255,255,255,0.05) 50%,
                rgba(255,255,255,0.1) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            box-shadow: 
                0 8px 32px rgba(0,0,0,0.3),
                inset 0 1px 0 rgba(255,255,255,0.2);
        }

        .tab-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.7);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border-radius: 8px;
            font-size: 0.75rem;
            padding: 0.5rem;
            cursor: pointer;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            color: white;
            box-shadow: 0 0 15px rgba(255,0,110,0.4);
        }

        .member-btn, .year-btn, .category-btn {
            background: linear-gradient(45deg, #ff006e, #8338ec, #3a86ff, #10b981);
            background-size: 300% 300%;
            animation: memberFlow 3s ease infinite;
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            padding: 0.75rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 50px;
            font-size: 0.85rem;
        }

        @keyframes memberFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .member-btn:hover, .year-btn:hover, .category-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,0.3);
        }

        .page-container {
            flex: 1;
            position: relative;
            min-height: 400px;
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 1rem;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .page.active {
            opacity: 1;
            transform: translateX(0);
        }

        .content-scroll {
            flex: 1;
            overflow-y: auto;
            padding-right: 0.5rem;
            max-height: 50vh;
        }

        .transaction-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.7rem;
            margin-top: 1rem;
        }

        .transaction-table th,
        .transaction-table td {
            padding: 0.5rem 0.25rem;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            color: white;
        }

        .transaction-table th {
            background: rgba(255,255,255,0.1);
            font-weight: 700;
            position: sticky;
            top: 0;
        }

        .amount.withdrawal { color: #ff6b6b; font-weight: 700; }
        .amount.deposit { color: #51cf66; font-weight: 700; }
        .amount.balance { color: #74c0fc; font-weight: 700; }

        .chart-container {
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .summary-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
        }

        .hero-balance {
            font-size: 2rem;
            font-weight: 900;
            color: #60a5fa;
            text-shadow: 0 0 20px rgba(96,165,250,0.5);
        }

        .hidden { display: none !important; }

        .floating-buttons {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 0.5rem;
            margin: 0.5rem 0;
            backdrop-filter: blur(10px);
        }

        .upload-area {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: rgba(255,255,255,0.6);
            background: rgba(255,255,255,0.05);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            color: white;
        }

        .input-field {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: white;
            width: 100%;
            margin: 0.5rem 0;
        }

        .input-field::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .btn-primary {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,0,110,0.4);
        }

        .unpaid-item {
            background: rgba(255,107,107,0.2);
            border: 1px solid rgba(255,107,107,0.3);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            color: white;
            font-size: 0.9rem;
        }

        .calendar-container {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .notice-item, .meeting-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .receipt-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }

        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border-radius: 10px;
        }

        .update-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .update-btn-small {
            background: linear-gradient(135deg, #ff006e, #8338ec);
            border: none;
            border-radius: 4px;
            color: white;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.7rem;
            transition: all 0.3s ease;
        }

        .update-btn-small:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(255,0,110,0.4);
        }

        .edit-form {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 0;
        }

        .edit-form input {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            padding: 0.5rem;
            color: white;
            margin: 0.25rem;
            font-size: 0.8rem;
        }

        .edit-form input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        /* ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ */
        #loginOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        .login-box {
            width: 90%;
            max-width: 420px;
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 1rem;
        }
        .login-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ -->
    <div id="loginOverlay">
        <div class="login-box">
            <h3 class="text-lg font-bold mb-2">ğŸ” íšŒì› í™•ì¸</h3>
            <p class="text-xs text-gray-300">ë³¸ì¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.</p>
            <div class="mt-2">
                <input type="text" id="loginNameInput" class="input-field" placeholder="ì´ë¦„ ì…ë ¥">
                <button class="btn-primary w-full" onclick="tryLoginFromInput()">ë¡œê·¸ì¸</button>
            </div>

    <!-- ë¦¬ìŠ¤íŠ¸ íŒì—… ëª¨ë‹¬ -->
    <div id="listModal" class="modal hidden">
        <div class="modal-content" style="max-width: 420px; width: 90%;">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold" id="listModalTitle">ğŸ“‹ ìƒì„¸ ë‚´ì—­</h3>
                <button onclick="document.getElementById('listModal').classList.add('hidden')" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div class="content-scroll" id="listModalBody" style="max-height: 60vh;"></div>
        </div>
    </div>
            <div id="loginError" class="text-red-400 text-xs mt-2"></div>
        </div>
    </div>
    <!-- ê³µì§€ì‚¬í•­ íŒì—… -->
    <div id="noticeModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ“¢ ìµœì‹  ê³µì§€ì‚¬í•­</h3>
                <button onclick="closeNoticeModal()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="noticeContent" class="content-scroll" style="max-height: 60vh;">
                <!-- ê³µì§€ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
            </div>
            <div class="mt-4">
                <button class="btn-primary w-full" onclick="closeNoticeModal()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ëª¨ì„ ì¼ì • íŒì—… -->
    <div id="meetingModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ“… ë‹¤ìŒ ëª¨ì„ ì¼ì •</h3>
                <button onclick="closeMeetingModal()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="meetingContent">
                <!-- ëª¨ì„ ë‚´ìš©ì´ ë™ì ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤ -->
            </div>
            <div class="mt-4">
                <button class="btn-primary w-full" onclick="closeMeetingModal()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- ë°ì´í„° ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="updateModal" class="modal hidden">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ”„ ë°ì´í„° ê´€ë¦¬</h3>
                <button onclick="closeUpdateModal()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="passwordArea">
                <input type="password" id="updatePassword" class="input-field" placeholder="ê´€ë¦¬ì ì½”ë“œ ì…ë ¥">
                <button class="btn-primary w-full mt-2" onclick="checkPassword()">í™•ì¸</button>
            </div>
            <div id="dataArea" class="hidden">
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button class="tab-btn active" id="pasteDataTab" onclick="showUpdateTab('paste')">ì—…ë°ì´íŠ¸</button>
                    <button class="tab-btn" id="editDataTab" onclick="showUpdateTab('edit')">ìˆ˜ì •í•˜ê¸°</button>
                </div>
                <div id="pasteArea">
                    <textarea id="updateData" class="input-field h-24" placeholder="ì—‘ì…€ ë°ì´í„°ë¥¼ ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”..."></textarea>
                    <button class="btn-primary w-full mb-2" onclick="processUpdateFromPaste()">ë¶™ì—¬ë„£ê¸°</button>
                    <div class="upload-area mt-2" onclick="document.getElementById('csvUpload').click()">
                        <i class="fas fa-file-csv text-2xl text-green-400"></i>
                        <p>CSV íŒŒì¼ë¡œ ì—…ë°ì´íŠ¸</p>
                        <input type="file" id="csvUpload" accept=".csv" style="display: none;" onchange="handleFileUpload(event)">
                    </div>
                </div>
                <div id="editArea" class="hidden">
                    <div class="content-scroll" style="max-height: 300px;">
                        <table class="transaction-table"><thead><tr><th>ë‚ ì§œ</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th><th>ìˆ˜ì •</th></tr></thead>
                            <tbody id="updateTransactionList"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìˆ˜ì • í¼ ëª¨ë‹¬ -->
    <div id="editModal" class="modal hidden">
        <div class="modal-content">
             <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ğŸ“ í•­ëª© ìˆ˜ì •</h3>
                <button onclick="cancelEdit()" class="text-white text-xl hover:text-red-400">&times;</button>
            </div>
            <div id="editForm" class="edit-form">
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="text" id="editNo" placeholder="No." readonly>
                    <input type="text" id="editDate" placeholder="ë‚ ì§œ (YY.MM.DD)">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="text" id="editContent" placeholder="ê¸°ì¬ë‚´ìš©">
                    <input type="text" id="editMemo" placeholder="ë©”ëª¨">
                </div>
                <div class="grid grid-cols-2 gap-2 mb-3">
                    <input type="number" id="editWithdrawal" placeholder="ì°¾ì€ê¸ˆì•¡" min="0">
                    <input type="number" id="editDeposit" placeholder="ë§¡ê¸´ê¸ˆì•¡" min="0">
                </div>
                <div class="flex gap-2 mt-4">
                    <button class="btn-primary flex-1" onclick="saveEdit()">ì €ì¥</button>
                    <button class="btn-primary flex-1" onclick="cancelEdit()">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <div class="glass-card p-3 text-center mb-3">
            <div class="update-title">
                <h1 class="text-lg font-black flex-1"><i class="fas fa-coins mr-2 text-yellow-400"></i>ì‚¬ì´ì¢‹ê³„ ê±°ë˜ë‚´ì—­</h1>
                <button id="manageBtn" class="update-btn-small" style="display:none;" onclick="openUpdateModal()"><i class="fas fa-sync-alt"></i> ê´€ë¦¬</button>
                <button class="update-btn-small ml-2" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            <div class="text-sm text-gray-300 mt-1" id="currentDate"></div>
            <div class="text-sm text-gray-200 mt-1" id="currentMember">ì‚¬ì´ì¢‹ê³„ íšŒì›: -</div>
        </div>

        <!-- Tab Navigation -->
        <div class="glass-card p-2 mb-3">
            <div class="grid grid-cols-4 gap-1 mb-2">
                <button class="tab-btn active" data-page="0">ì „ì²´</button>
                <button class="tab-btn" data-page="1">ë…„ë³„</button>
                <button class="tab-btn" data-page="2">íšŒì›ë³„</button>
                <button class="tab-btn" data-page="3">ì§€ì¶œ</button>
            </div>
            <div class="grid grid-cols-4 gap-1">
                <button class="tab-btn" data-page="4">ë¯¸ë‚©ê¸ˆ</button>
                <button class="tab-btn" data-page="5">ì˜ìˆ˜ì¦</button>
                <button class="tab-btn" data-page="6">ê³µì§€</button>
                <button class="tab-btn" data-page="7">ê³µì§€ë“±ë¡</button>
            </div>
        </div>

        <!-- Floating Buttons -->
        <div id="yearButtons" class="floating-buttons hidden"><div class="grid grid-cols-4 gap-2"><button class="year-btn" data-year="2023">2023</button><button class="year-btn" data-year="2024">2024</button><button class="year-btn" data-year="2025">2025</button><button class="year-btn active" data-year="all">ì „ì²´</button></div></div>
        <div id="memberButtons" class="floating-buttons hidden"><div class="grid grid-cols-4 gap-2 mb-2"><button class="member-btn" data-member="ê¹€ë´‰ì² ">ê¹€ë´‰ì² </button><button class="member-btn" data-member="ê¹€ë´‰ì •">ê¹€ë´‰ì •</button><button class="member-btn" data-member="ë°°ì •ê¸¸">ë°°ì •ê¸¸</button><button class="member-btn" data-member="ì´í•´ê²½">ì´í•´ê²½</button></div><div class="grid grid-cols-4 gap-2"><button class="member-btn" data-member="í™©ìƒí˜¸">í™©ìƒí˜¸</button><button class="member-btn" data-member="ê³½ìƒíƒœ">ê³½ìƒíƒœ</button><button class="member-btn" data-member="ì´í•œìš±">ì´í•œìš±</button><button class="member-btn" data-member="@ì´ì">ì´ì</button></div></div>
        <div id="expenseButtons" class="floating-buttons hidden"><div class="grid grid-cols-2 gap-2"><button class="category-btn active" data-expense-type="monthly">ì›”ë³„</button><button class="category-btn" data-expense-type="category">í•­ëª©ë³„</button></div></div>

        <!-- Page Container -->
        <div class="page-container glass-card" style="flex-grow: 1;">
            <!-- Page 0: ì „ì²´ -->
            <div class="page active" data-page="0">
                <h2 class="text-lg font-bold mb-3">ğŸ’° ì „ì²´ ê±°ë˜ë‚´ì—­</h2>
                <div class="hero-balance mb-2 text-center" id="mainPageBalance">0ì›</div>
                <div class="summary-grid"><div class="summary-item"><div class="text-xs text-gray-300">ì´ ì…ê¸ˆ</div><div class="text-green-400 font-bold" id="totalDeposit">0ì›</div></div><div class="summary-item"><div class="text-xs text-gray-300">ì´ ì§€ì¶œ</div><div class="text-red-400 font-bold" id="totalWithdrawal">0ì›</div></div></div>
                <div class="summary-grid"><div class="summary-item"><div class="text-xs text-gray-300">í˜„ì¬ ì”ì•¡</div><div class="text-blue-400 font-bold" id="currentBalance">0ì›</div></div><div class="summary-item"><div class="text-xs text-gray-300">ê±°ë˜ ê±´ìˆ˜</div><div class="text-white font-bold" id="totalTransactions">0ê±´</div></div></div>
                <div class="content-scroll" id="allTransactionsContainer"><table class="transaction-table"><thead><tr><th>ë‚ ì§œ</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th><th>ì”ì•¡</th></tr></thead><tbody id="allTransactions"></tbody></table></div>
                <div class="flex justify-center mt-2"><button id="prevPageBtn" class="btn-primary">ì´ì „</button><span id="pageIndicator" class="mx-4 self-center"></span><button id="nextPageBtn" class="btn-primary">ë‹¤ìŒ</button></div>
            </div>

            <!-- Page 1: ë…„ë³„ -->
            <div class="page" data-page="1"><h2 class="text-lg font-bold mb-3">ğŸ“Š ë…„ë³„ í†µê³„</h2><div class="chart-container"><canvas id="yearlyChart"></canvas></div><div class="content-scroll"><div id="yearlyStats"></div></div></div>

            <!-- Page 2: íšŒì›ë³„ -->
            <div class="page" data-page="2"><h2 class="text-lg font-bold mb-3">ğŸ‘¥ íšŒì›ë³„ í˜„í™©</h2><div id="memberStats" class="summary-grid hidden"><div class="summary-item"><div class="text-xs text-gray-300">ì´ ì…ê¸ˆì•¡</div><div class="text-green-400 font-bold" id="memberTotalAmount">0ì›</div></div><div class="summary-item"><div class="text-xs text-gray-300">ì…ê¸ˆ íšŸìˆ˜</div><div class="text-blue-400 font-bold" id="memberTotalCount">0íšŒ</div></div></div><div class="content-scroll"><table class="transaction-table"><thead><tr><th>ë‚ ì§œ</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th><th>ë©”ëª¨</th></tr></thead><tbody id="memberTransactions"></tbody></table></div></div>

            <!-- Page 3: ì§€ì¶œ (ê·¸ë˜í”„ + ìƒì„¸ ë¦¬ìŠ¤íŠ¸) -->
            <div class="page" data-page="3">
                <h2 class="text-lg font-bold mb-3">ğŸ’¸ ì§€ì¶œ ë¶„ì„</h2>
                <div class="chart-container" style="height: 200px;"><canvas id="expenseBarChart"></canvas></div>
                <div class="chart-container" style="height: 360px;"><canvas id="expenseDoughnutChart"></canvas></div>
                <div class="content-scroll" id="expenseDetails"></div>
            </div>

            <!-- Page 4: ë¯¸ë‚©ê¸ˆ -->
            <div class="page" data-page="4"><h2 class="text-lg font-bold mb-3">âš ï¸ ë¯¸ë‚©ê¸ˆ í˜„í™©</h2><p class="text-xs text-gray-400 mb-3" id="unpaidSubtitle"></p><div class="content-scroll" id="unpaidList"></div></div>

            <!-- Page 5: ì˜ìˆ˜ì¦ -->
            <div class="page" data-page="5"><h2 class="text-lg font-bold mb-3">ğŸ“· ì˜ìˆ˜ì¦ ê´€ë¦¬</h2><div class="content-scroll"><button class="btn-primary w-full mb-4" onclick="document.getElementById('receiptUpload').click()">ì˜ìˆ˜ì¦ ë“±ë¡</button><input type="file" id="receiptUpload" accept="image/*" style="display: none;" onchange="handleReceiptUpload(event)"><div id="receiptList"></div></div></div>

            <!-- Page 6: ê³µì§€(ìµœì‹  1ê±´ë§Œ í‘œì‹œ) -->
            <div class="page" data-page="6"><h2 class="text-lg font-bold mb-3">ğŸ“¢ ê³µì§€ì‚¬í•­</h2><div class="content-scroll"><div id="latestNotice" class="notice-item"></div></div></div>

            <!-- Page 7: ê³µì§€ ë“±ë¡ -->
            <div class="page" data-page="7">
                <h2 class="text-lg font-bold mb-3">ğŸ“ ê³µì§€ ë“±ë¡</h2>
                <div class="content-scroll">
                    <div class="mb-4">
                        <input type="text" id="noticeUser" class="input-field" placeholder="ë“±ë¡ì ì´ë¦„">
                        <textarea id="newNotice" class="input-field h-24" placeholder="ìƒˆ ê³µì§€ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        <button class="btn-primary mt-2 w-full" onclick="addNotice()"><i class="fas fa-megaphone mr-2"></i>ê³µì§€ ë“±ë¡</button>
                    </div>

                    <button id="toggleMeetingFormBtn" class="btn-primary w-full mb-2" onclick="toggleMeetingForm()">ëª¨ì„ ë“±ë¡</button>
                    <div id="meetingFormContainer" class="calendar-container hidden">
                        <input type="text" id="meetingUser" class="input-field mb-2" placeholder="ë“±ë¡ì ì´ë¦„">
                        <input type="datetime-local" id="meetingDate" class="input-field mb-2">
                        <input type="text" id="meetingPlace" class="input-field mb-2" placeholder="ëª¨ì„ ì¥ì†Œë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                        <textarea id="meetingDescription" class="input-field h-16" placeholder="ëª¨ì„ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        <button class="btn-primary w-full mt-2" onclick="addMeeting()"><i class="fas fa-calendar-plus mr-2"></i>ëª¨ì„ ë“±ë¡</button>
                    </div>

                    <button id="togglePrevMeetingsBtn" class="btn-primary w-full mb-2" onclick="togglePreviousMeetings()">ì´ì „ ëª¨ì„ ë³´ê¸°</button>
                    <div id="meetingList" class="hidden"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="./logs.js"></script>
    <script src="./data.js"></script>
    <script>
        // ì„œë²„ API ê¸°ë³¸ ì£¼ì†Œ (ë™ì¼ ë„ë©”ì¸ ì‚¬ìš©, íŒŒì¼ë¡œ ì—´ë ¸ë‹¤ë©´ localhost:3000)
        const API_BASE = (location.protocol === 'file:') ? 'http://localhost:3000' : '';
        // =================================================================================
        // ì „ì—­ ë³€ìˆ˜, ìƒìˆ˜ ë° ìƒíƒœ ê´€ë¦¬
        // =================================================================================
        let allTransactionData = [];
        let notices = [];
        let meetings = [];
        let receipts = [];
        
        let currentPage = 0;
        const ITEMS_PER_PAGE = 20; // ì „ì²´ ë·°ì˜ í˜ì´ì§€ë‹¹ í•­ëª© ìˆ˜

        let yearlyChart, expenseBarChart, expenseDoughnutChart;
        let selectedExpenseCategory = null;
        let editingIndex = -1;
        let isPasswordVerified = false;

        const MEMBERS = {
            'ê¹€ë´‰ì² ': { aliases: ['ë°•í¬ì •'] }, 'ê¹€ë´‰ì •': { aliases: ['ê°•ê·€ì„ '] },
            'ë°°ì •ê¸¸': { aliases: ['ì´ê¸ˆì'] }, 'ì´í•´ê²½': { aliases: [] },
            'í™©ìƒí˜¸': { aliases: [] }, 'ê³½ìƒíƒœ': { aliases: [] },
            'ì´í•œìš±': { aliases: ['ì •ë¯¸ìˆ™'] }
        };
        const ALL_MEMBER_NAMES = Object.keys(MEMBERS);

        // =================================================================================
        // ì´ˆê¸°í™” ë° ë°ì´í„° ë¡œë”©
        // =================================================================================
        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            loadData();
            normalizeData();
            updateCurrentDate();
            setupEventListeners();
            setupLoginOverlay();
            enforceLogin();
            updateManageVisibility();
            updateCurrentMemberDisplay();
            showPage(0); // ì´ˆê¸° í˜ì´ì§€ ì„¤ì • (ì˜¤ë²„ë ˆì´ê°€ ê°€ë¦½ë‹ˆë‹¤)
            showInitialNotice();
        }

        function setupLoginOverlay() {
            // ì´ë¦„ ì…ë ¥ë§Œ ì‚¬ìš©í•˜ë¯€ë¡œ ë²„íŠ¼ ê·¸ë¦¬ë“œê°€ ì—†ì„ ìˆ˜ ìˆìŒ
            const btnWrap = document.getElementById('loginMemberButtons');
            if (!btnWrap) return;
            btnWrap.innerHTML = '';
        }
        function enforceLogin() {
            const current = sessionStorage.getItem('memberName');
            if (!current || !ALL_MEMBER_NAMES.includes(current)) {
                document.getElementById('loginOverlay').style.display = 'flex';
            }
        }
        function handleLogin(name) {
            if (ALL_MEMBER_NAMES.includes(name)) {
                sessionStorage.setItem('memberName', name);
                document.getElementById('loginOverlay').style.display = 'none';
                updateManageVisibility();
                updateCurrentMemberDisplay();
                // ê¸°ë³¸ìœ¼ë¡œ íšŒì›ë³„ íƒ­ì— ë³¸ì¸ ë°ì´í„° í‘œì‹œ ê°€ëŠ¥
                // showPage(2); showMemberData(name);
            } else {
                const err = document.getElementById('loginError');
                err.textContent = 'ì‚¬ì´ì¢‹ê³„ íšŒì›ì´ ì•„ë‹™ë‹ˆë‹¤. ê°€ì¡±ì´ë©´ ë‚¨í¸ì˜ ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.';
                alert('ì‚¬ì´ì¢‹ê³„ íšŒì›ì´ ì•„ë‹™ë‹ˆë‹¤.\nê°€ì¡±ì´ë©´ ë‚¨í¸ì˜ ì´ë¦„ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”.');
            }
        }
        function tryLoginFromInput() {
            const v = (document.getElementById('loginNameInput').value || '').trim();
            handleLogin(v);
        }
        function logout() {
            sessionStorage.removeItem('memberName');
            document.getElementById('loginOverlay').style.display = 'flex';
            updateManageVisibility();
            updateCurrentMemberDisplay();
        }

        function updateManageVisibility() {
            const btn = document.getElementById('manageBtn');
            if (!btn) return;
            const current = sessionStorage.getItem('memberName');
            btn.style.display = current === 'ê¹€ë´‰ì •' ? 'inline-block' : 'none';
        }

        function updateCurrentMemberDisplay() {
            const el = document.getElementById('currentMember');
            if (!el) return;
            const name = sessionStorage.getItem('memberName');
            el.textContent = `ì‚¬ì´ì¢‹ê³„ íšŒì›: ${name && ALL_MEMBER_NAMES.includes(name) ? name : '-'}`;
        }

        function loadData() {
            if (typeof window.jotData !== 'undefined') {
                allTransactionData = JSON.parse(JSON.stringify(window.jotData.transactions || []));
                notices = JSON.parse(JSON.stringify(window.jotData.notices || []));
                console.log('ë°ì´í„° ë¡œë“œ ì„±ê³µ (data.js)');
            } else {
                console.warn("data.js ë¡œë”© ì‹¤íŒ¨. localStorage ë˜ëŠ” ìƒ˜í”Œ ë°ì´í„°ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.");
                allTransactionData = getSampleData();
                notices = loadFromLocalStorage('notices');
            }
            meetings = loadFromLocalStorage('meetings');
            receipts = loadFromLocalStorage('receipts');
        }

        function normalizeData() {
            const nameMap = {};
            for (const [name, { aliases }] of Object.entries(MEMBERS)) {
                aliases.forEach(alias => { nameMap[alias] = name; });
            }
            allTransactionData.forEach(item => {
                const alias = Object.keys(nameMap).find(a => item.ê¸°ì¬ë‚´ìš©.includes(a) || (item.ë©”ëª¨ && item.ë©”ëª¨.includes(a)));
                if (alias) item.ê¸°ì¬ë‚´ìš© = nameMap[alias];
            });
            allTransactionData.sort((a, b) => b['No.'] - a['No.']);
            notices.sort((a, b) => b.id - a.id);
        }

        // ì§€ì¶œ ì¹´í…Œê³ ë¦¬ íŒë³„ ë° ìƒì„¸ íŒì—… í—¬í¼
        function getExpenseCategory(text) {
            if (!text) return 'ê¸°íƒ€';
            if (text.includes('ì •ê·œëª¨ì„')) return 'ì •ê·œëª¨ì„';
            if (text.includes('ê²½ì¡°ì‚¬')) return 'ê²½ì¡°ì‚¬';
            if (text.includes('ìˆ™ì†Œ')) return 'ìˆ™ì†Œë¹„';
            return 'ê¸°íƒ€';
        }
        function openCategoryDetails(category) {
            const year = new Date().getFullYear();
            const items = allTransactionData.filter(i => i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ > 0 && parseYear(i.ê±°ë˜ì¼ì‹œ) === year && getExpenseCategory(i.ê¸°ì¬ë‚´ìš©) === category);
            const container = document.getElementById('expenseDetails');
            if (!container) return;
            if (!items.length) {
                container.innerHTML = `<div class="summary-item text-center">${year}ë…„ ${category} ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
                return;
            }
            const rows = items.map(i => `<tr><td>${formatDate(i.ê±°ë˜ì¼ì‹œ)}</td><td>${i.ê¸°ì¬ë‚´ìš©}</td><td class="amount withdrawal">-${formatNumber(i.ì°¾ìœ¼ì‹ ê¸ˆì•¡)}ì›</td></tr>`).join('');
            container.innerHTML = `<h3 class="text-md font-bold mt-2 mb-2">${year}ë…„ ${category} ë‚´ì—­</h3><table class="transaction-table"><thead><tr><th>ë‚ ì§œ</th><th>í•­ëª©</th><th>ê¸ˆì•¡</th></tr></thead><tbody>${rows}</tbody></table>`;
        }
        function selectExpenseCategory(category) {
            selectedExpenseCategory = category;
            try { if (expenseBarChart) expenseBarChart.update(); } catch(_) {}
            try { if (expenseDoughnutChart) expenseDoughnutChart.update(); } catch(_) {}
            openCategoryDetails(category);
        }

        // =================================================================================
        // ë Œë”ë§ ë° UI ì—…ë°ì´íŠ¸
        // =================================================================================
        function renderCurrentPage() {
            const pageNum = parseInt(document.querySelector('.tab-btn.active').dataset.page);
            showPage(pageNum, false);
        }

        function updateCurrentDate() {
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
        }

        function renderAllTransactions() {
            const tbody = document.getElementById('allTransactions');
            tbody.innerHTML = '';
            const paginatedData = allTransactionData.slice(currentPage * ITEMS_PER_PAGE, (currentPage + 1) * ITEMS_PER_PAGE);
            paginatedData.forEach(item => {
                const isDeposit = item.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0;
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.ê±°ë˜ì¼ì‹œ)}</td>
                        <td>${item.ê¸°ì¬ë‚´ìš©}</td>
                        <td class="amount ${isDeposit ? 'deposit' : 'withdrawal'}">${isDeposit ? '+' : '-'}${formatNumber(isDeposit ? item.ë§¡ê¸°ì‹ ê¸ˆì•¡ : item.ì°¾ìœ¼ì‹ ê¸ˆì•¡)}ì›</td>
                        <td class="amount balance">${formatNumber(item['ê±°ë˜í›„ ì”ì•¡'])}ì›</td>
                    </tr>`;
            });
            document.getElementById('pageIndicator').textContent = `${currentPage + 1} / ${Math.ceil(allTransactionData.length / ITEMS_PER_PAGE)}`;
            document.getElementById('prevPageBtn').disabled = currentPage === 0;
            document.getElementById('nextPageBtn').disabled = currentPage >= Math.ceil(allTransactionData.length / ITEMS_PER_PAGE) - 1;
        }

        function renderSummary() {
            const totalDeposit = allTransactionData.reduce((sum, item) => sum + (item.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0), 0);
            const totalWithdrawal = allTransactionData.reduce((sum, item) => sum + (item.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0), 0);
            const currentBalance = allTransactionData.length > 0 ? (allTransactionData[0]['ê±°ë˜í›„ ì”ì•¡'] || 0) : 0;
            document.getElementById('totalDeposit').textContent = formatNumber(totalDeposit) + 'ì›';
            document.getElementById('totalWithdrawal').textContent = formatNumber(totalWithdrawal) + 'ì›';
            document.getElementById('currentBalance').textContent = formatNumber(currentBalance) + 'ì›';
            document.getElementById('totalTransactions').textContent = allTransactionData.length + 'ê±´';
            const mpb = document.getElementById('mainPageBalance');
            if (mpb) mpb.textContent = formatNumber(currentBalance) + 'ì›';
        }

        // =================================================================================
        // ê¸°ëŠ¥ë³„ êµ¬í˜„
        // =================================================================================
        function calculateUnpaidAmounts() {
            // ê·œì¹™
            // - ê¸°ì¤€ ì‹œì‘ì›”: 2023-01
            // - ì˜¤ëŠ˜ ë‚ ì§œê¹Œì§€ì˜ ì´ ê°œì›” ìˆ˜ Ã— ì›” íšŒë¹„(ê¸°ë³¸ 3ë§Œì›, ê³½ìƒíƒœ 2ë§Œì›)
            // - ì‹¤ì œ ì…ê¸ˆ ì´ì•¡ì´ ê¸°ëŒ€ì•¡ë³´ë‹¤ ì ìœ¼ë©´ ë¶€ì¡±ì•¡ = ë¯¸ë‚©ê¸ˆ
            // - ìµœê·¼ ë¯¸ë‚©ì›”ì€ (ë‚©ë¶€ë¡œ ì¶©ì¡±ëœ ê°œì›” ìˆ˜ ë‹¤ìŒ ë‹¬)

            const startYear = 2023;
            const startMonth = 1; // 1~12
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1; // 1~12

            const totalMonthsFromStart = (currentYear - startYear) * 12 + (currentMonth - startMonth) + 1;
            const subtitleEl = document.getElementById('unpaidSubtitle');
            if (subtitleEl) subtitleEl.textContent = `(${currentYear}ë…„ ${currentMonth}ì›” ê¸°ì¤€ Â· ë‹¹ì›”ë¶„ í¬í•¨ í‘œê¸°)`;

            // ì›” íšŒë¹„
            const monthlyFee = (name) => name === 'ê³½ìƒíƒœ' ? 20000 : 30000;

            // íšŒì›ë³„ ì´ ì…ê¸ˆ í•©ê³„
            const memberTotals = {};
            ALL_MEMBER_NAMES.forEach(name => memberTotals[name] = 0);
            allTransactionData.forEach(item => {
                if (item.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0 && ALL_MEMBER_NAMES.includes(item.ê¸°ì¬ë‚´ìš©)) {
                    memberTotals[item.ê¸°ì¬ë‚´ìš©] += item.ë§¡ê¸°ì‹ ê¸ˆì•¡;
                }
            });

            // ìœ í‹¸: ê°œì›” ì¸ë±ìŠ¤ë¥¼ ì—°ì›”ë¡œ ë°”ê¾¸ê³  ë¼ë²¨ ìƒì„± (0 = 2023-01)
            const indexToYearMonth = (idx) => {
                const y = startYear + Math.floor((startMonth - 1 + idx) / 12);
                const m = ((startMonth - 1 + idx) % 12) + 1;
                return { y, m };
            };
            const formatYYMMLabel = ({ y, m }) => {
                const yy = ('' + y).slice(2);
                const mm = String(m).padStart(2, '0');
                return `${yy}ë…„ ${mm}ì›”ë¶„ ë¯¸ë‚©`;
            };

            const unpaidList = document.getElementById('unpaidList');
            unpaidList.innerHTML = '';

            const currentUser = sessionStorage.getItem('memberName');
            const isAdmin = currentUser === 'ê¹€ë´‰ì •';
            const targetMembers = isAdmin
                ? ALL_MEMBER_NAMES
                : ((currentUser && ALL_MEMBER_NAMES.includes(currentUser)) ? [currentUser] : ALL_MEMBER_NAMES);

            targetMembers.forEach(member => {
                const fee = monthlyFee(member);
                const expected = totalMonthsFromStart * fee;
                let paid = memberTotals[member];
                // 11ì›” ê¸°ì¤€: ê³½ìƒíƒœëŠ” ë¯¸ë‚© ì—†ìŒìœ¼ë¡œ í‘œì‹œ
                if (member === 'ê³½ìƒíƒœ' && currentMonth === 11) {
                    paid = Math.max(paid, expected);
                }
                const shortage = Math.max(0, expected - paid);

                if (shortage > 0) {
                    // ì¶©ì¡±ëœ ê°œì›” ìˆ˜ì™€ ë¯¸ë‚© ì›” ëª©ë¡(ìµœëŒ€ 2ê°œì›” í‘œì‹œ)
                    const coveredMonths = Math.floor(paid / fee);
                    const unpaidByMoney = Math.ceil(shortage / fee);
                    const unpaidByCalendar = Math.max(0, totalMonthsFromStart - coveredMonths);
                    const unpaidCount = Math.min(unpaidByMoney, unpaidByCalendar);
                    const firstUnpaidIdx = Math.min(coveredMonths, totalMonthsFromStart - 1);
                    const lastUnpaidIdx = Math.min(firstUnpaidIdx + unpaidCount - 1, totalMonthsFromStart - 1);
                    const months = [];
                    for (let idx = firstUnpaidIdx; idx <= lastUnpaidIdx; idx++) {
                        months.push(indexToYearMonth(idx));
                    }
                    const lastTwo = months.slice(-2);
                    const labels = lastTwo.map(({ y, m }) => {
                        const isThisMonth = (y === currentYear && m === currentMonth);
                        return isThisMonth ? 'ë‹¹ì›”ë¶„' : `${String(m).padStart(2,'0')}ì›”`;
                    }).join(', ');

                    // í‘œì‹œ: ì´ ë¯¸ë‚©ê¸ˆ + ìµœê·¼ ìµœëŒ€ 2ê°œì›” ì•ˆë‚´
                    unpaidList.innerHTML += `
                        <div class="unpaid-item">
                            <div class="flex justify-between items-center">
                                <span>ğŸ‘¤ ${member}</span>
                                <span class="text-red-400 font-bold">${formatNumber(shortage)}ì›</span>
                            </div>
                            <div class="text-xs text-gray-300 mt-1">ë¯¸ë‚©ê¸ˆ ${formatNumber(fee)}ì› Â· ${labels}</div>
                        </div>`;
                }
            });

            if (!unpaidList.innerHTML) {
                const name = isAdmin ? 'ëª¨ë“  íšŒì›' : (currentUser && ALL_MEMBER_NAMES.includes(currentUser) ? currentUser : 'ëª¨ë“  íšŒì›');
                unpaidList.innerHTML = `<div class="summary-item text-center"><i class="fas fa-check-circle text-green-400 text-2xl"></i><p>${name} ì •ìƒ ë‚©ë¶€!</p></div>`;
            }
        }

        function createYearlyChart(year) {
            const ctx = document.getElementById('yearlyChart').getContext('2d');
            if (yearlyChart) yearlyChart.destroy();
            const filtered = year === 'all' ? allTransactionData : allTransactionData.filter(i => parseYear(i.ê±°ë˜ì¼ì‹œ) === parseInt(year));
            const monthlyData = Array(12).fill(0).map(() => ({ deposit: 0, withdrawal: 0 }));
            filtered.forEach(i => {
                const month = parseInt(i.ê±°ë˜ì¼ì‹œ.split('.')[1]) - 1;
                if (month >= 0 && month < 12) {
                    monthlyData[month].deposit += i.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0;
                    monthlyData[month].withdrawal += i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0;
                }
            });
            yearlyChart = new Chart(ctx, { type: 'bar', data: { labels: Array.from({ length: 12 }, (_, i) => `${i + 1}ì›”`), datasets: [{ label: 'ì…ê¸ˆ', data: monthlyData.map(d => d.deposit), backgroundColor: 'rgba(81, 207, 102, 0.8)' }, { label: 'ì§€ì¶œ', data: monthlyData.map(d => d.withdrawal), backgroundColor: 'rgba(255, 107, 107, 0.8)' }] }, options: getChartOptions() });
            updateYearlyStats(year, filtered);
        }

        function updateYearlyStats(year, filtered) {
            const totalDeposit = filtered.reduce((s, i) => s + (i.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0), 0);
            const totalWithdrawal = filtered.reduce((s, i) => s + (i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0), 0);
            document.getElementById('yearlyStats').innerHTML = `<div class="summary-grid"><div class="summary-item"><div class="text-xs">${year === 'all' ? 'ì „ì²´' : year} ì…ê¸ˆ</div><div class="text-green-400 font-bold">${formatNumber(totalDeposit)}ì›</div></div><div class="summary-item"><div class="text-xs">${year === 'all' ? 'ì „ì²´' : year} ì§€ì¶œ</div><div class="text-red-400 font-bold">${formatNumber(totalWithdrawal)}ì›</div></div></div>`;
        }

        // ì§€ì¶œ ê·¸ë˜í”„: ì—°ê°„ ì¹´í…Œê³ ë¦¬ í•©ê³„ë§Œ í‘œì‹œ (ë§‰ëŒ€ + ë„ë„›)
        function renderExpenseCharts() {
            const year = new Date().getFullYear();
            const expenseData = allTransactionData.filter(i => i.ì°¾ìœ¼ì‹ ê¸ˆì•¡ > 0 && parseYear(i.ê±°ë˜ì¼ì‹œ) === year);

            const categories = ['ì •ê·œëª¨ì„', 'ê²½ì¡°ì‚¬', 'ìˆ™ì†Œë¹„', 'ê¸°íƒ€'];
            const categoryTotals = Object.fromEntries(categories.map(c => [c, 0]));
            expenseData.forEach(item => { categoryTotals[getExpenseCategory(item.ê¸°ì¬ë‚´ìš©)] += item.ì°¾ìœ¼ì‹ ê¸ˆì•¡; });

            const palette = {
                'ì •ê·œëª¨ì„': 'rgba(255, 107, 107, 0.9)',
                'ê²½ì¡°ì‚¬': 'rgba(254, 202, 87, 0.9)',
                'ìˆ™ì†Œë¹„': 'rgba(72, 219, 251, 0.9)',
                'ê¸°íƒ€': 'rgba(29, 209, 161, 0.9)'
            };

            const labels = categories;
            const values = categories.map(c => categoryTotals[c]);
            const maxIdx = values.indexOf(Math.max(...values));
            const maxLabel = labels[maxIdx] || '';
            const maxValue = values[maxIdx] || 0;

            // ê¸ˆì•¡ ë¼ë²¨ í”ŒëŸ¬ê·¸ì¸ (ë§‰ëŒ€ ìœ„ ê¸ˆì•¡ í‘œì‹œ)
            const valueLabelPlugin = {
                id: 'valueLabel',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    ctx.save();
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 10px Noto Sans KR';
                    const meta = chart.getDatasetMeta(0);
                    if (!meta) return;
                    meta.data.forEach((pt, i) => {
                        const val = values[i] || 0;
                        const txt = new Intl.NumberFormat('ko-KR').format(val);
                        ctx.textAlign = 'center';
                        ctx.fillText(txt, pt.x, pt.y - 6);
                    });
                    ctx.restore();
                }
            };

            // ë§‰ëŒ€ ê·¸ë˜í”„ (ì„ íƒ í•­ëª© í•˜ì´ë¼ì´íŠ¸: ì„ íƒ ì™¸ íˆ¬ëª…ë„ ë‚®ì¶¤)
            if (expenseBarChart) expenseBarChart.destroy();
            expenseBarChart = new Chart(
                document.getElementById('expenseBarChart').getContext('2d'),
                {
                    type: 'bar',
                    data: { labels, datasets: [{ label: `${year} ì§€ì¶œ í•©ê³„`, data: values, backgroundColor: labels.map(l => {
                        const base = palette[l];
                        if (!selectedExpenseCategory || selectedExpenseCategory === l) return base;
                        return base.replace('0.9', '0.3');
                    }) }] },
                    options: Object.assign({}, getChartOptions(), { scales: { y: { ticks: { color: 'white' } } } }),
                    plugins: [valueLabelPlugin]
                }
            );

            // ë„ë„› ê·¸ë˜í”„: ì¤‘ì•™ í…ìŠ¤íŠ¸
            const centerText = {
                id: 'centerText',
                afterDraw(chart) {
                    const { ctx, chartArea: { width, height } } = chart;
                    ctx.save();
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.font = 'bold 12px Noto Sans KR';
                    ctx.fillText(maxLabel, width / 2, height / 2 - 6);
                    ctx.font = 'bold 14px Noto Sans KR';
                    ctx.fillText(new Intl.NumberFormat('ko-KR').format(maxValue) + 'ì›', width / 2, height / 2 + 14);
                    ctx.restore();
                }
            };

            if (expenseDoughnutChart) expenseDoughnutChart.destroy();
            expenseDoughnutChart = new Chart(
                document.getElementById('expenseDoughnutChart').getContext('2d'),
                {
                    type: 'doughnut',
                    data: {
                        labels: labels.map((l, i) => `${l} (${new Intl.NumberFormat('ko-KR').format(values[i])}ì›)`),
                        datasets: [{ 
                            data: values,
                            backgroundColor: labels.map(l => palette[l]),
                            offset: (ctx) => {
                                const idx = ctx.dataIndex;
                                return labels[idx] === selectedExpenseCategory ? 12 : 0;
                            },
                            borderWidth: (ctx) => (labels[ctx.dataIndex] === selectedExpenseCategory ? 2 : 0),
                            borderColor: '#fff'
                        }]
                    },
                    options: Object.assign({}, getChartOptions(false), {
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: { color: 'white', boxWidth: 12, padding: 12 },
                                onClick: (e, legendItem, legend) => {
                                    const idx = legendItem.index;
                                    const cat = labels[idx];
                                    selectExpenseCategory(cat);
                                }
                            }
                        },
                        layout: { padding: { top: 10, bottom: 10 } },
                        cutout: '65%'
                    }),
                    plugins: [centerText]
                }
            );
            // ì´ˆê¸° ì•ˆë‚´
            const details = document.getElementById('expenseDetails');
            if (details) details.innerHTML = '<div class="summary-item text-center">í•­ëª© ë²”ë¡€ë¥¼ í´ë¦­í•˜ë©´ ì—°ê°„ í•´ë‹¹ í•­ëª©ì˜ ìƒì„¸ ë‚´ì—­ì´ ì•„ë˜ì— í‘œì‹œë©ë‹ˆë‹¤.</div>';
        }

        function showMemberData(member) {
            document.getElementById('memberStats').classList.remove('hidden');
            const tbody = document.getElementById('memberTransactions');
            const filtered = allTransactionData.filter(item => item.ê¸°ì¬ë‚´ìš© === member || (member === '@ì´ì' && item.ê¸°ì¬ë‚´ìš©.includes('ì´ì')));
            const totalAmount = filtered.reduce((s, i) => s + (i.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0), 0);
            document.getElementById('memberTotalAmount').textContent = formatNumber(totalAmount) + 'ì›';
            document.getElementById('memberTotalCount').textContent = filtered.filter(i => i.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0).length + 'íšŒ';
            tbody.innerHTML = '';
            filtered.forEach(item => {
                const isDeposit = (item.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0) > 0;
                const amount = isDeposit ? item.ë§¡ê¸°ì‹ ê¸ˆì•¡ : item.ì°¾ìœ¼ì‹ ê¸ˆì•¡;
                tbody.innerHTML += `<tr><td>${formatDate(item.ê±°ë˜ì¼ì‹œ)}</td><td>${item.ê¸°ì¬ë‚´ìš©}</td><td class="amount ${isDeposit ? 'deposit' : 'withdrawal'}">${isDeposit ? '+' : '-'}${formatNumber(amount)}ì›</td><td>${item.ë©”ëª¨ || ''}</td></tr>`;
            });
        }

        // ë°ì´í„° ê´€ë¦¬ (ì—…ë°ì´íŠ¸/ìˆ˜ì •)
        function openUpdateModal() { document.getElementById('updateModal').classList.remove('hidden'); }
        function closeUpdateModal() {
            document.getElementById('updateModal').classList.add('hidden');
            document.getElementById('passwordArea').classList.remove('hidden');
            document.getElementById('dataArea').classList.add('hidden');
            document.getElementById('updatePassword').value = '';
            isPasswordVerified = false;
        }
        function checkPassword() {
            if (document.getElementById('updatePassword').value === '9480') {
                isPasswordVerified = true;
                document.getElementById('passwordArea').classList.add('hidden');
                document.getElementById('dataArea').classList.remove('hidden');
                showUpdateTab('paste');
            } else {
                alert('ì½”ë“œê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }
        function showUpdateTab(tab) {
            document.getElementById('pasteArea').classList.toggle('hidden', tab !== 'paste');
            document.getElementById('editArea').classList.toggle('hidden', tab !== 'edit');
            document.getElementById('pasteDataTab').classList.toggle('active', tab === 'paste');
            document.getElementById('editDataTab').classList.toggle('active', tab === 'edit');
            if (tab === 'edit') renderUpdateTransactionList();
        }
        function renderUpdateTransactionList() {
            const tbody = document.getElementById('updateTransactionList');
            tbody.innerHTML = '';
            allTransactionData.forEach((item, index) => {
                const isDeposit = item.ë§¡ê¸°ì‹ ê¸ˆì•¡ > 0;
                tbody.innerHTML += `
                    <tr>
                        <td>${formatDate(item.ê±°ë˜ì¼ì‹œ)}</td>
                        <td>${item.ê¸°ì¬ë‚´ìš©}</td>
                        <td class="amount ${isDeposit ? 'deposit' : 'withdrawal'}">${isDeposit ? '+' : '-'}${formatNumber(isDeposit ? item.ë§¡ê¸°ì‹ ê¸ˆì•¡ : item.ì°¾ìœ¼ì‹ ê¸ˆì•¡)}</td>
                        <td><button class="update-btn-small" onclick="editTransaction(${index})">ìˆ˜ì •</button></td>
                    </tr>`;
            });
        }
        
        function processUpdateFromPaste() {
            const data = document.getElementById('updateData').value.trim();
            if (!data) return;
            try {
                const newItems = parseCSV(data);
                if (newItems.length > 0) {
                    updateTransactionData(newItems);
                }
            } catch (error) { alert('ë°ì´í„° ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message); }
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const newItems = parseCSV(e.target.result);
                    if (newItems.length > 0) {
                        updateTransactionData(newItems);
                    } else {
                        alert('íŒŒì¼ì—ì„œ ìƒˆë¡œìš´ ê±°ë˜ë‚´ì—­ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                    }
                } catch (error) {
                    alert(`íŒŒì¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`);
                }
            };
            reader.readAsText(file, 'EUC-KR'); // ì—‘ì…€ CSV ê¸°ë³¸ ì¸ì½”ë”©
        }

        function parseCSV(csvData) {
            const lines = csvData.split(/\r?\n/).filter(line => line.trim());
            if (lines.length === 0) return [];

            // êµ¬ë¶„ì íŒë³„: íƒ­ ìš°ì„ , ì—†ìœ¼ë©´ ì½¤ë§ˆ
            const detectDelimiter = (line) => (line.includes('\t') ? '\t' : ',');
            const firstDelim = detectDelimiter(lines[0]);
            const split = (line) => line.split(firstDelim).map(p => p.trim().replace(/^\"|\"$/g, ''));

            const headers = split(lines[0]).map(h => h.replace(/\s+/g, ''));
            const hasHeader = headers.some(h => ['ì—°ë„','ì›”','ê±°ë˜ì¼ì‹œ2','ë‚´ìš©','ë¹„ê³ ','ì§€ì¶œ','ì§€ì…','ì”ì•¡','êµ¬ë¶„','ë¹„ê³ 2','ê±°ë˜ì¼ì‹œ','ê¸°ì¬ë‚´ìš©'].includes(h));

            const rows = hasHeader ? lines.slice(1) : lines;

            // ìœ í‹¸
            const toNumber = (s) => {
                if (s == null) return 0;
                const v = String(s).replace(/,/g, '').replace(/\s/g, '');
                const n = parseFloat(v || '0');
                return isNaN(n) ? 0 : n;
            };
            const normDate = (d, y, m) => {
                if (d && /\d{4}-\d{2}-\d{2}/.test(d)) {
                    const [Y, M, D] = d.split('-');
                    return `${Y.slice(2)}.${M}.${D}`;
                }
                if (d && /\d{2}\.\d{2}\.\d{2}/.test(d)) return d; // ì´ë¯¸ í˜•ì‹í™”ë¨
                if (y && m) {
                    // day ë¯¸ì œê³µ ì‹œ 01ì¼ë¡œ ìƒì„±
                    const yy = String(y).slice(-2);
                    const mm = String(m).padStart(2,'0');
                    return `${yy}.${mm}.01`;
                }
                return d || '';
            };
            const resolveNameAlias = (name) => {
                const aliasOwner = Object.keys(MEMBERS).find(n => (MEMBERS[n].aliases||[]).includes(name));
                return aliasOwner || name;
            };

            // í—¤ë” ì¸ë±ìŠ¤ ë§µí•‘
            const idx = (key) => {
                const keyNoSpace = key.replace(/\s+/g, '');
                const i = headers.findIndex(h => h === keyNoSpace);
                return i === -1 ? null : i;
            };

            const iYear = hasHeader ? idx('ì—°ë„') : null;
            const iMonth = hasHeader ? idx('ì›”') : null;
            const iDate2 = hasHeader ? idx('ê±°ë˜ì¼ì‹œ2') : null;
            const iDate = hasHeader ? (idx('ê±°ë˜ì¼ì‹œ') ?? iDate2) : 1;
            const iContent = hasHeader ? (idx('ë‚´ìš©') ?? idx('ê¸°ì¬ë‚´ìš©')) : 2;
            const iMemo = hasHeader ? idx('ë¹„ê³ ') : 6;
            const iMemo2 = hasHeader ? idx('ë¹„ê³ 2') : null;
            const iWithdrawal = hasHeader ? idx('ì§€ì¶œ') : 3;
            const iDeposit = hasHeader ? idx('ì§€ì…') : 4;
            const iBalance = hasHeader ? idx('ì”ì•¡') : 5;

            // ë³€í™˜
            return rows.map((line, rowIdx) => {
                const parts = split(line);
                const yearVal = iYear != null ? parts[iYear] : null;
                const monthVal = iMonth != null ? parts[iMonth] : null;
                const dateRaw = iDate != null ? parts[iDate] : null;
                const dateStr = normDate(dateRaw, yearVal, monthVal);
                let content = iContent != null ? parts[iContent] : '';
                content = resolveNameAlias(content);
                const memoA = iMemo != null ? (parts[iMemo] || '') : '';
                const memoB = iMemo2 != null ? (parts[iMemo2] || '') : '';
                const memo = [memoA, memoB].filter(Boolean).join(' ');
                const withdrawal = iWithdrawal != null ? toNumber(parts[iWithdrawal]) : 0;
                const deposit = iDeposit != null ? toNumber(parts[iDeposit]) : 0;
                const balance = iBalance != null ? toNumber(parts[iBalance]) : 0;

                return {
                    "No.": Date.now() + rowIdx, // ì„ì‹œ No. (ì •ë ¬ í›„ ìœ ì§€)
                    "ê±°ë˜ì¼ì‹œ": dateStr,
                    "ê¸°ì¬ë‚´ìš©": content,
                    "ì°¾ìœ¼ì‹ ê¸ˆì•¡": withdrawal,
                    "ë§¡ê¸°ì‹ ê¸ˆì•¡": deposit,
                    "ê±°ë˜í›„ ì”ì•¡": balance,
                    "ë©”ëª¨": memo
                };
            });
        }

        function updateTransactionData(newItems) {
            const existingEntries = new Set(allTransactionData.map(item => `${item.ê±°ë˜ì¼ì‹œ}_${item.ê¸°ì¬ë‚´ìš©}`));
            const uniqueNewItems = newItems.filter(item => !existingEntries.has(`${item.ê±°ë˜ì¼ì‹œ}_${item.ê¸°ì¬ë‚´ìš©}`));

            if (uniqueNewItems.length > 0) {
                allTransactionData = [...uniqueNewItems, ...allTransactionData];
                normalizeData();
                // Replit ì„œë²„ì— ì¦‰ì‹œ ì €ì¥
                if (typeof saveFileToServer === 'function') {
                    saveFileToServer('data', generateNewDataFileContent());
                    alert(`${uniqueNewItems.length}ê°œì˜ ìƒˆë¡œìš´ ê±°ë˜ë‚´ì—­ì´ ì¶”ê°€/ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                } else {
                    showDataUpdateModal(generateNewDataFileContent());
                    alert(`${uniqueNewItems.length}ê°œì˜ ìƒˆë¡œìš´ ê±°ë˜ë‚´ì—­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. data.js íŒŒì¼ì„ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.`);
                }
                renderCurrentPage();
                closeUpdateModal();
            } else {
                alert("ìƒˆë¡œìš´ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        function editTransaction(index) {
            editingIndex = index;
            const item = allTransactionData[index];
            document.getElementById('editNo').value = item['No.'];
            document.getElementById('editDate').value = item.ê±°ë˜ì¼ì‹œ;
            document.getElementById('editContent').value = item.ê¸°ì¬ë‚´ìš©;
            document.getElementById('editMemo').value = item.ë©”ëª¨;
            document.getElementById('editWithdrawal').value = item.ì°¾ìœ¼ì‹ ê¸ˆì•¡ || 0;
            document.getElementById('editDeposit').value = item.ë§¡ê¸°ì‹ ê¸ˆì•¡ || 0;
            document.getElementById('editModal').classList.remove('hidden');
        }
        function saveEdit() {
            if (editingIndex === -1) return;
            const item = allTransactionData[editingIndex];
            item.ê±°ë˜ì¼ì‹œ = document.getElementById('editDate').value;
            item.ê¸°ì¬ë‚´ìš© = document.getElementById('editContent').value;
            item.ë©”ëª¨ = document.getElementById('editMemo').value;
            item.ì°¾ìœ¼ì‹ ê¸ˆì•¡ = parseFloat(document.getElementById('editWithdrawal').value) || 0;
            item.ë§¡ê¸°ì‹ ê¸ˆì•¡ = parseFloat(document.getElementById('editDeposit').value) || 0;
            normalizeData();
            renderCurrentPage();
            renderUpdateTransactionList();
            cancelEdit();
            // Replit ì„œë²„ì— ì¦‰ì‹œ ì €ì¥
            if (typeof saveFileToServer === 'function') {
                saveFileToServer('data', generateNewDataFileContent());
            } else {
                showDataUpdateModal(generateNewDataFileContent());
            }
        }
        function cancelEdit() {
            editingIndex = -1;
            document.getElementById('editModal').classList.add('hidden');
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë° ë°ì´í„° íŒŒì¼ ì—…ë°ì´íŠ¸ ì•ˆë‚´
        function loadFromLocalStorage(key) { return JSON.parse(localStorage.getItem(key) || '[]'); }
        function saveToLocalStorage(key, data) { localStorage.setItem(key, JSON.stringify(data)); }

        function showDataUpdateModal(newContent) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.zIndex = '1001'; // ë‹¤ë¥¸ ëª¨ë‹¬ ìœ„ì— í‘œì‹œ
            modal.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-lg font-bold mb-4">ë°ì´í„° ì—…ë°ì´íŠ¸ í•„ìš”</h3>
                    <p class="mb-4">ì•„ë˜ ë‚´ìš©ì„ ë³µì‚¬í•˜ì—¬ <strong>data.js</strong> íŒŒì¼ ì „ì²´ì— ë®ì–´ì“°ì„¸ìš”.</p>
                    <textarea class="input-field" style="height: 200px; font-size: 0.7rem;" readonly>${newContent}</textarea>
                    <div class="flex gap-2 mt-4">
                        <button class="btn-primary flex-1" onclick="navigator.clipboard.writeText(this.previousElementSibling.value); alert('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');">ë³µì‚¬</button>
                        <button class="btn-primary flex-1" onclick="this.closest('.modal').remove()">ë‹«ê¸°</button>
                    </div>
                </div>`;
            document.body.appendChild(modal);
        }

        function generateNewDataFileContent() {
            const dataToSave = {
                transactions: allTransactionData,
                notices: notices
            };
            return `window.jotData = ${JSON.stringify(dataToSave, null, 4)};`;
        }
        function generateNewLogsFileContent() {
            const logsToSave = Array.isArray(window.jotLogs) ? window.jotLogs : [];
            return `window.jotLogs = ${JSON.stringify(logsToSave, null, 4)};`;
        }

        // Replit ì„œë²„ì— íŒŒì¼ ì €ì¥
        async function saveFileToServer(fileName, fileContent) {
            try {
                const resp = await fetch(`${API_BASE}/update-data-9480`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ file: fileName, content: fileContent })
                });
                if (!resp.ok) {
                    const msg = await resp.text();
                    alert('ì„œë²„ ì €ì¥ ì‹¤íŒ¨: ' + msg);
                } else {
                    console.log(`${fileName} íŒŒì¼ì´ ì„œë²„ì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            } catch (e) {
                console.error('ì„œë²„ ì „ì†¡ ì˜¤ë¥˜:', e);
                alert('ì„œë²„ ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function loadReceipts() {
            const list = document.getElementById('receiptList');
            list.innerHTML = '';
            try {
                // ì„œë²„ì—ì„œ IMG ëª©ë¡ì„ ë¶ˆëŸ¬ì™€ ìµœì‹ ìˆœ í‘œì‹œ
                const resp = await fetch(`${API_BASE}/images`);
                if (resp.ok) {
                    const items = await resp.json();
                    if (!items.length) { list.innerHTML = '<div class="summary-item text-center">ë“±ë¡ëœ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
                    items.forEach(it => {
                        list.innerHTML += `<div class="receipt-item" onclick="viewReceipt('${it.url}')"><div class="font-bold">${it.fileName}</div><div class="text-sm text-gray-400">ì„œë²„ ì €ì¥ Â· ìµœì‹ ìˆœ</div></div>`;
                    });
                    return;
                }
            } catch (_) {}
            // í´ë°±: ê¸°ì¡´ localStorage
            receipts = loadFromLocalStorage('receipts');
            if (!receipts.length) { list.innerHTML = '<div class="summary-item text-center">ë“±ë¡ëœ ì˜ìˆ˜ì¦ì´ ì—†ìŠµë‹ˆë‹¤.</div>'; return; }
            receipts.forEach(r => {
                list.innerHTML += `<div class="receipt-item" onclick="viewReceipt('${r.dataUrl}')"><div class="font-bold">${r.name}</div><div class="text-sm text-gray-400">ë“±ë¡ì: ${r.user} | ${r.date}</div></div>`;
            });
        }
        async function handleReceiptUpload(event) {
            const file = event.target.files[0];
            const user = sessionStorage.getItem('memberName');
            if (!file) return;
            if (!user || !ALL_MEMBER_NAMES.includes(user)) { alert('ë¡œê·¸ì¸ í›„ ì´ìš©í•˜ì„¸ìš”.'); return; }
            try {
                const fd = new FormData();
                fd.append('file', file);
                fd.append('user', user);
                const resp = await fetch(`${API_BASE}/upload-receipt`, { method: 'POST', body: fd });
                if (!resp.ok) { alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (await resp.text())); return; }
                const result = await resp.json();
                // ì„œë²„ê°€ ì €ì¥í•œ íŒŒì¼ ê²½ë¡œ ë° OCR ê²°ê³¼ í™œìš©
                const savedName = result.fileName || file.name;
                const ocr = result.ocr || {};
                const tx = {
                    "No.": Date.now(),
                    "ê±°ë˜ì¼ì‹œ": ocr.date || new Date().toISOString().slice(2,10).replaceAll('-','.'),
                    "ê¸°ì¬ë‚´ìš©": ocr.category || 'ì˜ìˆ˜ì¦',
                    "ì°¾ìœ¼ì‹ ê¸ˆì•¡": Math.max(0, Number(ocr.amount) || 0),
                    "ë§¡ê¸°ì‹ ê¸ˆì•¡": 0,
                    "ê±°ë˜í›„ ì”ì•¡": (allTransactionData[0]?.['ê±°ë˜í›„ ì”ì•¡'] || 0) - (Number(ocr.amount) || 0),
                    "ë©”ëª¨": (ocr.memo ? `${ocr.memo} ` : '') + `[ì˜ìˆ˜ì¦:${savedName}] ë“±ë¡ì:${user}`
                };
                allTransactionData = [tx, ...allTransactionData];
                normalizeData();
                // ì„œë²„ì— data.js ì €ì¥
                if (typeof saveFileToServer === 'function') {
                    await saveFileToServer('data', generateNewDataFileContent());
                }
                // ë¡œì»¬ ì˜ìˆ˜ì¦ ëª©ë¡ í‘œì‹œëŠ” ê¸°ì¡´ëŒ€ë¡œ ìœ ì§€
                receipts.unshift({ id: Date.now(), name: savedName, user, date: new Date().toLocaleString('ko-KR'), dataUrl: result.publicUrl || '' });
                saveToLocalStorage('receipts', receipts);
                loadReceipts();
                addNotice(user, `${user}ë‹˜ì´ ì˜ìˆ˜ì¦(${savedName})ì„ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.`);
            } catch (e) {
                alert('ì˜ìˆ˜ì¦ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜: ' + e.message);
            }
        }
        function viewReceipt(dataUrl) { window.open(dataUrl, '_blank'); }

        function renderLogItemHTML(log) {
            const icon = log.type === 'meeting' ? 'ğŸ“…' : 'ğŸ“¢';
            return `<div class="notice-item">
                <div class="flex justify-between items-start mb-2">
                    <div class="text-sm text-gray-400"><b>${icon} ${log.type.toUpperCase()}</b> | ${log.timestamp}</div>
                </div>
                <div>${log.description.replace(/\n/g, '<br>')}</div>
            </div>`;
        }

        function loadNotices() {
            const latestBox = document.getElementById('latestNotice');
            const logs = (window.jotLogs || []).slice();
            latestBox.innerHTML = logs.length ? renderLogItemHTML(logs[0]) : '<div class="summary-item text-center">ë“±ë¡ëœ ê³µì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        function togglePreviousNotices() {
            const prevBox = document.getElementById('previousNotices');
            const btn = document.getElementById('togglePrevBtn');
            const isHidden = prevBox.classList.contains('hidden');
            if (isHidden) {
                prevBox.classList.remove('hidden');
                btn.textContent = 'ì´ì „ ê³µì§€ ìˆ¨ê¸°ê¸°';
            } else {
                prevBox.classList.add('hidden');
                btn.textContent = 'ì´ì „ ê³µì§€ ë³´ê¸°';
            }
        }
        function addNotice(user, content) {
            // ë¡œê·¸ì¸ ì‚¬ìš©ì ìš°ì„ 
            const loginUser = sessionStorage.getItem('memberName');
            const userVal = loginUser && ALL_MEMBER_NAMES.includes(loginUser)
                ? loginUser
                : (user || document.getElementById('noticeUser').value.trim());
            const contentVal = content || document.getElementById('newNotice').value.trim();
            if (userVal && contentVal) {
                notices.unshift({ id: Date.now(), user: userVal, content: contentVal, date: new Date().toLocaleString('ko-KR') });
                document.getElementById('noticeUser').value = '';
                document.getElementById('newNotice').value = '';
                loadNotices();
                if (typeof logActivity === 'function') {
                    logActivity('notice', `${userVal}: ${contentVal}`);
                }
                // Replit ì„œë²„ì— logs.js ì €ì¥
                if (typeof saveFileToServer === 'function') {
                    saveFileToServer('logs', generateNewLogsFileContent());
                } else {
                    showDataUpdateModal(generateNewLogsFileContent());
                }
            }
        }
        function deleteNotice(id) {
            if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                notices = notices.filter(n => n.id !== id);
                loadNotices();
                showDataUpdateModal(generateNewDataFileContent());
            }
        }
        function showInitialNotice() {
            const lastShown = sessionStorage.getItem('lastNoticeShown');
            if (!lastShown) {
                const noticeContent = document.getElementById('noticeContent');
                noticeContent.innerHTML = '';
                notices.slice(0, 5).forEach(n => {
                    noticeContent.innerHTML += `<div class="notice-item"><b>${n.user}</b>: ${n.content} <span class="text-xs text-gray-400">(${n.date})</span></div>`;
                });
                document.getElementById('noticeModal').classList.remove('hidden');
                sessionStorage.setItem('lastNoticeShown', 'true');
            }
        }

        function loadMeetings() {
            meetings = loadFromLocalStorage('meetings');
            const list = document.getElementById('meetingList');
            list.innerHTML = '';
            meetings.forEach(m => {
                list.innerHTML += `<div class="meeting-item"><div class="flex justify-between items-start mb-2"><div class="text-sm text-gray-400"><b>${m.user}</b> | ${m.created}</div><button onclick="deleteMeeting(${m.id})" class="text-red-400"><i class="fas fa-times"></i></button></div><div class="font-bold mb-2">ğŸ“… ${m.date}</div><div class="mb-2">ğŸ“ ${m.place}</div><div>ğŸ“ ${m.description.replace(/\n/g, '<br>')}</div></div>`;
            });
        }
        function addMeeting() {
            const user = document.getElementById('meetingUser').value.trim();
            const date = document.getElementById('meetingDate').value;
            const place = document.getElementById('meetingPlace').value.trim();
            const description = document.getElementById('meetingDescription').value.trim();
            if (!user || !date || !place) {
                alert('ë“±ë¡ì, ëª¨ì„ ë‚ ì§œ, ì¥ì†Œë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            const newMeeting = { id: Date.now(), user, date: new Date(date).toLocaleString('ko-KR'), place, description: description || 'ì •ê·œëª¨ì„', created: new Date().toLocaleString('ko-KR') };
            meetings.unshift(newMeeting);
            saveToLocalStorage('meetings', meetings);
            ['meetingUser', 'meetingDate', 'meetingPlace', 'meetingDescription'].forEach(id => document.getElementById(id).value = '');
            loadMeetings();
            addNotice(user, `${user}ë‹˜ì´ ëª¨ì„(${newMeeting.date} at ${newMeeting.place})ì„ ë“±ë¡í–ˆìŠµë‹ˆë‹¤.`);
            showMeetingPopup(newMeeting);
            if (typeof logActivity === 'function') {
                logActivity('meeting', `${user} ëª¨ì„ ë“±ë¡\nì¼ì‹œ: ${newMeeting.date}\nì¥ì†Œ: ${newMeeting.place}\në‚´ìš©: ${newMeeting.description}`);
            }
            // Replit ì„œë²„ì— logs.js ì €ì¥
            if (typeof saveFileToServer === 'function') {
                saveFileToServer('logs', generateNewLogsFileContent());
            } else {
                showDataUpdateModal(generateNewLogsFileContent());
            }
        }
        function deleteMeeting(id) {
            if (confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                meetings = meetings.filter(m => m.id !== id);
                saveToLocalStorage('meetings', meetings);
                loadMeetings();
            }
        }
        function showMeetingPopup(meeting) {
            const content = document.getElementById('meetingContent');
            content.innerHTML = `<div class="meeting-item"><p><strong>ğŸ—“ï¸ ì¼ì‹œ:</strong> ${meeting.date}</p><p><strong>ğŸ“ ì¥ì†Œ:</strong> ${meeting.place}</p><p><strong>ğŸ“ ë‚´ìš©:</strong> ${meeting.description}</p></div>`;
            document.getElementById('meetingModal').classList.remove('hidden');
        }

        // ê³µì§€ë“±ë¡ í˜ì´ì§€ì˜ ì„œë¸Œ ê¸°ëŠ¥: ëª¨ì„ í¼/ì´ì „ ëª¨ì„ í† ê¸€
        function toggleMeetingForm() {
            const box = document.getElementById('meetingFormContainer');
            const btn = document.getElementById('toggleMeetingFormBtn');
            const hidden = box.classList.contains('hidden');
            if (hidden) {
                box.classList.remove('hidden');
                btn.textContent = 'ëª¨ì„ ë“±ë¡ ìˆ¨ê¸°ê¸°';
            } else {
                box.classList.add('hidden');
                btn.textContent = 'ëª¨ì„ ë“±ë¡';
            }
        }
        function togglePreviousMeetings() {
            const list = document.getElementById('meetingList');
            const btn = document.getElementById('togglePrevMeetingsBtn');
            const hidden = list.classList.contains('hidden');
            if (hidden) {
                loadMeetings();
                list.classList.remove('hidden');
                btn.textContent = 'ì´ì „ ëª¨ì„ ìˆ¨ê¸°ê¸°';
            } else {
                list.classList.add('hidden');
                btn.textContent = 'ì´ì „ ëª¨ì„ ë³´ê¸°';
            }
        }

        // =================================================================================
        // ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë° í—¬í¼
        // =================================================================================
        function setupEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.addEventListener('click', handleTabClick));
            document.querySelectorAll('.year-btn').forEach(btn => btn.addEventListener('click', e => {
                document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                createYearlyChart(e.currentTarget.dataset.year);
            }));
            document.querySelectorAll('.member-btn').forEach(btn => btn.addEventListener('click', e => {
                document.querySelectorAll('.member-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                showMemberData(e.currentTarget.dataset.member);
            }));
            document.querySelectorAll('.category-btn').forEach(btn => btn.addEventListener('click', e => {
                document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                e.currentTarget.classList.add('active');
                renderExpenseDetails(e.currentTarget.dataset.expenseType);
            }));
            document.getElementById('prevPageBtn').addEventListener('click', () => { if (currentPage > 0) { currentPage--; renderAllTransactions(); } });
            document.getElementById('nextPageBtn').addEventListener('click', () => { if (currentPage < Math.ceil(allTransactionData.length / ITEMS_PER_PAGE) - 1) { currentPage++; renderAllTransactions(); } });
            document.addEventListener('keydown', e => { if (e.key === 'Escape') { closeAllModals(); } });
        }

        function handleTabClick(e) {
            const pageNum = parseInt(e.currentTarget.dataset.page);
            showPage(pageNum);
        }

        function showPage(pageNum, switchTabs = true) {
            if (switchTabs) {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelector(`.tab-btn[data-page="${pageNum}"]`).classList.add('active');
                hideAllFloatingButtons();
            }
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelector(`.page[data-page="${pageNum}"]`).classList.add('active');

            switch (pageNum) {
                case 0: renderAllTransactions(); renderSummary(); break;
                case 1: document.getElementById('yearButtons').classList.remove('hidden'); createYearlyChart('all'); break;
                case 2: document.getElementById('memberButtons').classList.remove('hidden'); showMemberData('ê¹€ë´‰ì² '); break;
                case 3: renderExpenseCharts(); break;
                case 4: calculateUnpaidAmounts(); break;
                case 5: loadReceipts(); break;
                case 6: loadNotices(); break;
                case 7: /* ê³µì§€ ë“±ë¡ í¼ */ break;
            }
        }

        function hideAllFloatingButtons() {
            ['yearButtons', 'memberButtons', 'expenseButtons'].forEach(id => document.getElementById(id).classList.add('hidden'));
        }

        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
            cancelEdit();
            closeUpdateModal();
        }
        function closeNoticeModal() { document.getElementById('noticeModal').classList.add('hidden'); }
        function closeMeetingModal() { document.getElementById('meetingModal').classList.add('hidden'); }

        function formatDate(dateStr) {
            try {
                const [y, m, d] = dateStr.split('.');
                return `${parseYear(dateStr)}ë…„ ${m}ì›” ${d}ì¼`;
            } catch { return dateStr; }
        }
        function parseYear(dateStr) {
            const yearPart = parseInt(dateStr.split('.')[0]);
            return yearPart >= 70 ? 1900 + yearPart : 2000 + yearPart;
        }
        function formatNumber(num) { return new Intl.NumberFormat('ko-KR').format(num); }
        function getChartOptions(showYAxis = true) {
            return {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { labels: { color: 'white' } } },
                scales: {
                    y: { display: showYAxis, beginAtZero: true, ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                }
            };
        }
    </script>
</body>
</html>
